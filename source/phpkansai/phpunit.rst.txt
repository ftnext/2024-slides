PHPUnitã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ã“ã†
============================================================================================================================================

å…ˆã®fizzbuzzé–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†

**PHPUnit**
--------------------------------------------------

* PHPã§ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
* https://phpunit.de/
* ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã®å­˜åœ¨ãŒã‚ã‚‹ã‚“ã§ã™ã­ï¼ˆPythonã«ã¯è¤‡æ•°å€™è£œãŒã‚ã‚Šã¾ã™ï¼‰

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* Composerã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

  * :command:`composer require --dev phpunit/phpunit`

* ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ `PHARã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€toolsä¸‹ã«ç½®ãæ–¹æ³•æ¨ã— <https://docs.phpunit.de/en/10.5/installation.html#manual-download-of-phar>`__

PHPUnitã§æ›¸ããƒ†ã‚¹ãƒˆã¯ **3** ã‚¹ãƒ†ãƒƒãƒ—
============================================================

1. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹
2. ã‚¯ãƒ©ã‚¹ã‚’æ›¸ã
3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã

Step1 ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
--------------------------------------------------

.. code-block:: txt

    .
    â”œâ”€â”€ src/
    â”‚   â””â”€â”€ fizzbuzz.php
    â”œâ”€â”€ tests/
    â”‚   â””â”€â”€ fizzbuzzTest.php
    â””â”€â”€ vendor/

PHPUnitã¯ã€æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® :file:`*Test.php` ã‚’æ¢ã™

Step2 ã‚¯ãƒ©ã‚¹ã‚’æ›¸ã
--------------------------------------------------

* PHPUnitãŒæä¾›ã™ã‚‹ **TestCaseã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿** ã—ãŸã‚¯ãƒ©ã‚¹ã‚’æ›¸ã
* **åå‰ã¯Testã§çµ‚ã‚ã‚‹**

.. code-block:: php

    use PHPUnit\Framework\TestCase;

    class FizzbuzzTest extends TestCase
    {
    }

Step3 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã (1/2)
--------------------------------------------------

**testã§å§‹ã¾ã‚‹** ãƒ¡ã‚½ãƒƒãƒ‰å

.. code-block:: php

    class FizzbuzzTest extends TestCase
    {
        public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(): void
        {
        }
    }

Step3 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã (2/2)
--------------------------------------------------

``fizzbuzz(3)`` ã¨å‘¼ã³å‡ºã—ãŸè¿”ã‚Šå€¤ã¯ã€æ–‡å­—åˆ— ``"Fizz"`` ã¨å‹ã¨å€¤ãŒåŒã˜ï¼ˆã¨è¡¨æ˜ï¼‰

.. code-block:: php

    class FizzbuzzTest extends TestCase
    {
        public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(): void
        {
            $this->assertSame(fizzbuzz(3), "Fizz");
        }
    }

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
============================================================

* :command:`vendor/bin/phpunit tests`
* ï¼ˆPHARã‚’é…ç½®ã—ãŸå ´åˆ :command:`tools/phpunit tests`ï¼‰

passã—ãŸã¨ã
--------------------------------------------------

.. code-block:: txt

    Runtime:       PHP 8.3.1

    .                                                                   1 / 1 (100%)

    Time: 00:00, Memory: 22.77 MB

    OK (1 test, 1 assertion)

failã—ãŸã¨ã
--------------------------------------------------

.. code-block:: txt

    Runtime:       PHP 8.3.1

    F                                                                   1 / 1 (100%)

    Time: 00:00.001, Memory: 22.77 MB

    There was 1 failure:

    1) fizzbuzz\FizzbuzzTest::test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™
    Failed asserting that two strings are identical.
    --- Expected
    +++ Actual
    @@ @@
    -'3'
    +'Fizz'

    /.../tests/fizzbuzzTest.php:16

    FAILURES!
    Tests: 1, Assertions: 1, Failures: 1.

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ§‹æˆè¦ç´ 
============================================================

.. code-block:: php

    $this->assertSame(fizzbuzz(3), "Fizz");

* é–¢æ•°ã« **ã‚ã‚‹å€¤ã‚’å…¥åŠ›ã—ãŸã¨ãã®å‡ºåŠ›** ã‚’æ¤œè¨¼ã—ãŸ
* *3A* ã¨ã„ã†è¦‹æ–¹ã‚’å°å…¥

3A
--------------------------------------------------

* Arrange æº–å‚™
* Act å®Ÿè¡Œ
* Assert æ¤œè¨¼

https://xp123.com/articles/3a-arrange-act-assert/

3Aã§è¦‹ã‚‹doctest
--------------------------------------------------

1ã‚¹ãƒ†ãƒƒãƒ—1è¡Œã«ãªã‚‹ã‚ˆã†ã«æ›¸ãç›´ã—ã¦ã„ã¾ã™

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17

Arrange
--------------------------------------------------

ãƒ†ã‚¹ãƒˆã® **æº–å‚™** ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ç”¨æ„ãªã©ï¼‰

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17
    :emphasize-lines: 5

Act
--------------------------------------------------

ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ã‚’ **å®Ÿè¡Œ**

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17
    :emphasize-lines: 6

Assert
--------------------------------------------------

å®Ÿè¡ŒçµæœãŒæœŸå¾…å€¤ã¨ç­‰ã—ã„ã‹ã‚’ **æ¤œè¨¼**

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17
    :emphasize-lines: 7-8

ç¬¬4ã®Aï¼šAnnihilate ğŸƒâ€â™‚ï¸ (skip)
--------------------------------------------------

* ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
* ã€`ãƒ­ãƒã‚¹ãƒˆPython <https://www.oreilly.co.jp/books/9784814400171/>`__ã€ç¬¬21ç« ã‚ˆã‚Š

tipsâœ¨ **ãƒ‘ãƒ©ãƒ¡ã‚¿åŒ–** ãƒ†ã‚¹ãƒˆ
============================================================

.. code-block:: php
    :caption: é¡Œæ

    public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(): void
    {
    }

3ã®å€æ•°ãªã‚‰Fizz
--------------------------------------------------

``$number`` ã® **å–ã‚Šã†ã‚‹å€¤ã¯è¤‡æ•°**

* 3
* 6
* 9

å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆã®é–¢æ•°ã‚’æ›¸ãï¼Ÿ
--------------------------------------------------

.. code-block:: php

    public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™_3ã®å ´åˆ(): void
    {
    }

    public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™_6ã®å ´åˆ(): void
    {
    }

PHPUnitã§ã¯ **Data Provider** ã‚’ä½¿ãŠã†
--------------------------------------------------

.. literalinclude:: ../../samplecode/phpunit-example/tests/parametrizedTest.php
    :language: php
    :lines: 6-7,10-22

Data Provider
--------------------------------------------------

* https://docs.phpunit.de/en/10.5/writing-tests-for-phpunit.html#data-providers

    | A data provider method must be public and static.
    | It must return a value that is iterable, either an array or an object that implements the Traversable interface.

Data Provider
--------------------------------------------------

.. literalinclude:: ../../samplecode/phpunit-example/tests/parametrizedTest.php
    :language: php
    :lines: 12-18

* ``$number`` ã«ã€3ã€6ã¨é †æ¬¡æ¸¡ã‚‹
* ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯1å›ã‚ãŸã‚Šè¤‡æ•°ã®å¤‰æ•°ã‚’æ¸¡ã™ä¾‹ã‚ã‚Š

1ã¤ã®é–¢æ•°ã€è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
--------------------------------------------------

**å€‹åˆ¥ã«æ›¸ã„ãŸã®ã¨åŒã˜** çµæœãŒå¾—ã‚‰ã‚Œã‚‹

.. code-block:: txt

    % tools/phpunit tests/parametrizedTest.php
    PHPUnit 10.5.10 by Sebastian Bergmann and contributors.

    Runtime:       PHP 8.3.1

    ..                                                                  2 / 2 (100%)

    Time: 00:00.001, Memory: 22.77 MB

    OK (2 tests, 2 assertions)
