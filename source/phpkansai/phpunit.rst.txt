PHPUnitã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ã“ã†
============================================================================================================================================

1éƒ¨ 2/2ç« ï¼šå…ˆã®fizzbuzzé–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†

**PHPUnit**
--------------------------------------------------

* PHPã§ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
* https://phpunit.de/

PHPUnitã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
============================================================

* Composer
* PHAR

ã©ã¡ã‚‰ã‹ã‚’ã‚„ã‚Œã°ã„ã„ã§ã™

Composerã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* :command:`composer require --dev phpunit/phpunit`
* ã¡ã‚‡ã†ãœã¤æœ¬ ãªã©

.. code-block:: txt

    .
    â”œâ”€â”€ composer.json
    â”œâ”€â”€ composer.lock
    â””â”€â”€ vendor/
        â””â”€â”€ bin/
            â””â”€â”€ phpunit

PHARã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* PHPUnitã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§æ¨ã—ã¦ã„ã‚‹
* https://docs.phpunit.de/en/10.5/installation.html#manual-download-of-phar

.. code-block:: txt

    .
    â””â”€â”€ tools/
        â””â”€â”€ phpunit

tips: Composerã§ã¯autoload ğŸƒâ€â™‚ï¸ (skip)
--------------------------------------------------

``require_once`` ã‚’ã‚«ãƒƒã‚³ã‚ˆãæ›¸ã‘ã¾ã™

.. code-block:: json
    :caption: composer.json å‚è€ƒä¾‹

    {
        "autoload": {
            "psr-4": {"FizzBuzz\\": "src/"}
        },
        "autoload-dev": {
            "psr-4": {"FizzBuzz\\": "tests/"}
        }
    }

phpunitã‚³ãƒãƒ³ãƒ‰ã®ä½¿ã„æ–¹
--------------------------------------------------

* :command:`vendor/bin/phpunit`
* ï¼ˆPHARã‚’é…ç½®ã—ãŸå ´åˆ :command:`tools/phpunit`ï¼‰

.. code-block:: txt

    Usage:
      phpunit [options] <directory|file> ...

.. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹

PHPUnitã§æ›¸ããƒ†ã‚¹ãƒˆã¯ **3** ã‚¹ãƒ†ãƒƒãƒ—
============================================================

1. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹
2. ã‚¯ãƒ©ã‚¹ã‚’æ›¸ã
3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã

Step1 ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
--------------------------------------------------

https://docs.phpunit.de/en/10.5/installation.html#manual-download-of-phar

.. code-block:: txt

    .
    â”œâ”€â”€ src/
    â”‚   â””â”€â”€ fizzbuzz.php
    â”œâ”€â”€ tests/
    â”‚   â””â”€â”€ fizzbuzzTest.php
    â””â”€â”€ vendor/

ï¼ˆComposerã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆã§é€²ã‚ã¾ã™ã€‚PHARã§ã‚‚å‹•ä½œç¢ºèªã—ã¦ã„ã¾ã™ï¼‰

ãƒ†ã‚¹ãƒˆã‚’æ›¸ããƒ•ã‚¡ã‚¤ãƒ«
--------------------------------------------------

* :file:`tests` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
* ãƒ•ã‚¡ã‚¤ãƒ«åã¯ **\*Test.php**

  * ``phpunit`` ã‚³ãƒãƒ³ãƒ‰ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚ŒãŸã¨ãã«æ¢ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

Step2 ã‚¯ãƒ©ã‚¹ã‚’æ›¸ã
--------------------------------------------------

* PHPUnitãŒæä¾›ã™ã‚‹ **TestCaseã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿** ã—ãŸã‚¯ãƒ©ã‚¹ã‚’æ›¸ã
* ã‚¯ãƒ©ã‚¹åã¯ **\*Test**

.. code-block:: php

    use PHPUnit\Framework\TestCase;

    class FizzbuzzTest extends TestCase
    {
    }

Step3 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã (1/2)
--------------------------------------------------

**testã§å§‹ã¾ã‚‹** ãƒ¡ã‚½ãƒƒãƒ‰å

.. code-block:: php

    class FizzbuzzTest extends TestCase
    {
        public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(): void
        {
        }
    }

Step3 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã (2/2)
--------------------------------------------------

``fizzbuzz(3)`` ã¨å‘¼ã³å‡ºã—ãŸè¿”ã‚Šå€¤ã¯ã€æ–‡å­—åˆ— ``"Fizz"`` ã¨å‹ã¨å€¤ãŒåŒã˜ï¼ˆã¨è¡¨æ˜ï¼‰

.. code-block:: php

    class FizzbuzzTest extends TestCase
    {
        public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(): void
        {
            $this->assertSame(fizzbuzz(3), "Fizz");
        }
    }

ä»Šå›ã¯assertSameãŒé©åˆ‡ã€‚assertEqualsã§ã¯ãªã„
--------------------------------------------------

.. code-block:: php

    php > var_dump("1" === "1");  // assertSame
    bool(true)
    php > var_dump("1" == 1);  // assertEquals
    bool(true)
    php > var_dump("1" === 1);  // assertSameãªã‚‰èª¤ã‚Šã«æ°—ã¥ã‘ã‚‹
    bool(false)

``Test`` Attributeã§ã‚‚ã‚ˆã„ ğŸƒâ€â™‚ï¸ (skip)
--------------------------------------------------

https://docs.phpunit.de/en/10.5/attributes.html#appendixes-attributes-test

.. code-block:: php

    use PHPUnit\Framework\Attributes\Test;

    class FizzbuzzTest extends TestCase
    {
        // é–¢æ•°åã¯3ã§å§‹ã‚ã‚‰ã‚Œãªã„ã®ã§ã€_ã‚’ä»˜ã‘ã¦ã„ã¾ã™ï¼ˆä»–ã®ã‚„ã‚Šæ–¹ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ï¼‰
        #[Test]
        public function _3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(): void
        {
        }
    }

æ—¥æœ¬èªãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ ğŸƒâ€â™‚ï¸ (skip)
--------------------------------------------------

* IMOï¼šé–¢æ•°åã¯ **æ—¥æœ¬èªã‚’ä½¿ã£ã¦ã‚‚ã‚ˆã„** ã¨æ€ã„ã¾ã™
* `å®Ÿè·µï¼ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå…¥é–€ï¼ˆPHPã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹2022ï¼‰ <https://speakerdeck.com/panda_program/unit-testing-for-beginners-at-php-conference-japan-2022?slide=41>`__
* `ç¾åœ¨æ™‚åˆ»ãŒé–¢ã‚ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‹ã‚‰ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§è¨­è¨ˆã‚’å­¦ã¶ <https://t-wada.hatenablog.jp/entry/design-for-testability#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88-%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%86%E3%82%B9%E3%83%88%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89>`__

ğŸ¥ŸPHPUnitã§æ›¸ããƒ†ã‚¹ãƒˆã¯3ã‚¹ãƒ†ãƒƒãƒ—
============================================================

1. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ï¼ˆ:file:`*Test.php`ï¼‰
2. ã‚¯ãƒ©ã‚¹ã‚’æ›¸ãï¼ˆ``*Test``ï¼‰
3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ãï¼ˆ``test*``ï¼‰

https://docs.phpunit.de/en/10.5/writing-tests-for-phpunit.html#asserting-return-values

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
============================================================

* :command:`vendor/bin/phpunit tests`
* ï¼ˆPHARã‚’é…ç½®ã—ãŸå ´åˆ :command:`tools/phpunit tests`ï¼‰

passã—ãŸã¨ã
--------------------------------------------------

.. code-block:: txt

    Runtime:       PHP 8.3.2

    .                                                                   1 / 1 (100%)

    Time: 00:00, Memory: 22.77 MB

    OK (1 test, 1 assertion)

failã—ãŸã¨ãï¼ˆã‚ã–ã¨è½ã¨ã—ãŸï¼‰
--------------------------------------------------

.. code-block:: txt

    Runtime:       PHP 8.3.2

    F                                                                   1 / 1 (100%)

    Time: 00:00.001, Memory: 22.77 MB

    There was 1 failure:

    1) fizzbuzz\FizzbuzzTest::test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™
    Failed asserting that two strings are identical.
    --- Expected
    +++ Actual
    @@ @@
    -'3'
    +'Fizz'

    /.../tests/fizzbuzzTest.php:16

    FAILURES!
    Tests: 1, Assertions: 1, Failures: 1.

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ§‹æˆè¦ç´ 
============================================================

.. code-block:: php

    $this->assertSame(fizzbuzz(3), "Fizz");

* é–¢æ•°ã« **ã‚ã‚‹å€¤ã‚’å…¥åŠ›ã—ãŸã¨ãã®å‡ºåŠ›** ã‚’æ¤œè¨¼ã—ãŸ
* *3A* ã¨ã„ã†è¦‹æ–¹ã‚’å°å…¥

3A
--------------------------------------------------

* Arrange æº–å‚™
* Act å®Ÿè¡Œ
* Assert æ¤œè¨¼

https://xp123.com/articles/3a-arrange-act-assert/

3Aã§è¦‹ã‚‹PHPUnit
--------------------------------------------------

1ã‚¹ãƒ†ãƒƒãƒ—1è¡Œã«ãªã‚‹ã‚ˆã†ã«æ›¸ãç›´ã—ã¦ã„ã¾ã™

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17

Arrange
--------------------------------------------------

ãƒ†ã‚¹ãƒˆã® **æº–å‚™** ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ç”¨æ„ãªã©ï¼‰

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17
    :emphasize-lines: 5

Act
--------------------------------------------------

ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚’ **å®Ÿè¡Œ** ï¼ˆå‘¼ã³å‡ºã™ï¼‰

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17
    :emphasize-lines: 6

Assert
--------------------------------------------------

å®Ÿè¡ŒçµæœãŒæœŸå¾…å€¤ã¨ç­‰ã—ã„ã‹ã‚’ **æ¤œè¨¼**

.. literalinclude:: ../../samplecode/phpunit-example/tests/fizzbuzzTest.php
    :language: php
    :lines: 8-17
    :emphasize-lines: 7-8

.. æ„å›³ã‚’ä¼ãˆã‚‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸ã¼ã†

ç¬¬4ã®Aï¼šAnnihilate ğŸƒâ€â™‚ï¸ (skip)
--------------------------------------------------

* ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
* ã€`ãƒ­ãƒã‚¹ãƒˆPython <https://www.oreilly.co.jp/books/9784814400171/>`__ã€ç¬¬21ç« ã‚ˆã‚Š

ğŸ¥Ÿãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ§‹æˆè¦ç´ ï¼š3A
============================================================

* Arrange ãƒ†ã‚¹ãƒˆã® **æº–å‚™**
* Act ãƒ†ã‚¹ãƒˆå¯¾è±¡ã® **å®Ÿè¡Œ**
* Assert å®Ÿè¡Œçµæœã¨æœŸå¾…å€¤ã® **æ¤œè¨¼**

tipsâœ¨ **ãƒ‘ãƒ©ãƒ¡ã‚¿åŒ–** ãƒ†ã‚¹ãƒˆ
============================================================

.. code-block:: php
    :caption: é¡Œæ

    public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(): void
    {
    }

3ã®å€æ•°ãªã‚‰Fizz
--------------------------------------------------

``$number`` ã® **å–ã‚Šã†ã‚‹å€¤ã¯è¤‡æ•°**

* 3
* 6
* 9

å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆã®é–¢æ•°ã‚’æ›¸ãï¼Ÿ
--------------------------------------------------

.. code-block:: php

    public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™_3ã®å ´åˆ(): void
    {
    }

    public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™_6ã®å ´åˆ(): void
    {
    }

**ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã«å¼•æ•°** ï¼ˆãƒ‘ãƒ©ãƒ¡ã‚¿ï¼‰ã‚’æ¸¡ã›ãŸã‚‰ï¼
--------------------------------------------------

.. code-block:: php

    class FizzbuzzTest extends TestCase
    {
        // $numberã«3ã‚„6ã‚’æ¸¡ã›ãŸã‚‰
        public function test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™($number): void
        {
            $this->assertSame(fizzbuzz($number), "Fizz");
        }
    }

PHPUnitã§ã¯ **Data Provider** ã§ã§ãã¾ã™ï¼
--------------------------------------------------

.. literalinclude:: ../../samplecode/phpunit-example/tests/parametrizedTest.php
    :language: php
    :lines: 5,7,10-22
    :linenos:

Data Provider
--------------------------------------------------

* https://docs.phpunit.de/en/10.5/writing-tests-for-phpunit.html#data-providers

    | A data provider method must be public and static.
    | It must return a value that is iterable, either an array or an object that implements the Traversable interface.

Data Providerã®ä¾‹
--------------------------------------------------

.. literalinclude:: ../../samplecode/phpunit-example/tests/parametrizedTest.php
    :language: php
    :lines: 12-18
    :linenos:

* ``$number`` ã«ã€3ã€6ã¨é †æ¬¡æ¸¡ã‚‹
* ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯1å›ã‚ãŸã‚Šè¤‡æ•°ã®å¤‰æ•°ã‚’æ¸¡ã™ä¾‹ã‚ã‚Š

1ã¤ã®é–¢æ•°ã€è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
--------------------------------------------------

**å€‹åˆ¥ã«æ›¸ã„ãŸã®ã¨åŒã˜** çµæœãŒå¾—ã‚‰ã‚Œã‚‹

.. code-block:: txt

    % tools/phpunit tests/parametrizedTest.php
    PHPUnit 10.5.10 by Sebastian Bergmann and contributors.

    Runtime:       PHP 8.3.2

    ..                                                                  2 / 2 (100%)

    Time: 00:00.001, Memory: 22.77 MB

    OK (2 tests, 2 assertions)
