テストコードが書けるメリット
============================================================

壊してないかなという **不安** に向き合う
============================================================

* 良いコード（変更しやすい、言語の機能を引き出している）に近づけていく
* 例：全霊をかけたコードだが、よりよい書き方を知って書き換える
* 変更するたびに、 **壊していないか** 不安

例：FizzBuzz
--------------------------------------------------

.. literalinclude:: ../../samplecode/phpunit-example/concept/fizzbuzz_old.php
    :language: php

型を書く（PHPの機能をもっと使う）
--------------------------------------------------

.. literalinclude:: ../../samplecode/phpunit-example/concept/fizzbuzz.php
    :language: php

書き換えで振る舞いを変えていないだろうか？
============================================================

**不安** に対処する3つのアプローチ

(A) 祈る 🙏
--------------------------------------------------

* 🙏🙏「どうか変わっていませんように」🙏🙏
* 振る舞いを変えていないか不安だが、 *何も確認はしない*

(B) 手で動作確認 ✋
--------------------------------------------------

* 例えば対話的に ``fizzbuzz`` 関数を実行（:command:`php -a`）

.. code-block:: php

    php > require 'fizzbuzz.php';
    php > echo fizzbuzz(15);
    FizzBuzz

* 安心できるが、 *関数の数が増えて* いくと現実的ではなさそう

参考：PHPの対話シェル 🏃‍♂️ (skip)
--------------------------------------------------

* https://www.php.net/manual/ja/features.commandline.interactive.php
* `はじめてのPHPコマンドラインオプション <https://speakerdeck.com/kotomin_m/hazimetenophpkomandorainopusiyon-phpkai-fa-wojin-yoritiyotutole-sikusuru?slide=8>`__ （ことみんさん。PHPカンファレンス沖縄2023）で知りました

(C) コードを書いて動作確認 🤖
--------------------------------------------------

* この発表の本題
* 「手で動作確認」の **自動化** （テストコードを書く）
* プログラムで使う部品のコードは、プログラムを書いて動作確認するという考え方（ref: ちょうぜつ本）

テストコードの世界へようこそ🎉
============================================================

初見だと独特と感じる **用語** を紹介

テストケース
--------------------------------------------------

* 1つ1つのテストのこと
* テストコードがある＝複数のテストケースがある

実行結果
--------------------------------------------------

テストケースをすべて実行すると

* **pass** （全て通る・成功）
* fail （1つでも失敗・落ちる）

テストにおける *値* の呼び方
--------------------------------------------------

* テスト対象（の関数やメソッド）を実行した値: **actual** value
* 期待結果: **expected** value

呼び方を反映した変数名
--------------------------------------------------

.. code-block:: php

    php > $actual = fizzbuzz(15);  // fizzbuzz関数がテスト対象
    php > $expected = "FizzBuzz";
    php > var_dump($actual === $expected);
    bool(true)

テストコードがあると
============================================================

.. list-table:: ``$actual === $expected`` を **簡単に確認** できる

    * - actual
      - expected
    * - ``fizzbuzz(3)``
      - ``"Fizz"``
    * - ``fizzbuzz(5)``
      - ``"Buzz"``
    * - ``fizzbuzz(15)``
      - ``"FizzBuzz"``

不安は退屈に変わる
--------------------------------------------------

* 実装中、仕様を満たす **動作するコード** であると確認できる🙌
* 書き換える際も、おかしくしていたら気付ける 🙌（*回帰テスト*）
* ただし、このトークで扱うテストコードとは **開発者のためのテスト** （QAのテストとは別）

書くコードは増えている、けれど
--------------------------------------------------

* 実装に加えてテストコードも書く
* でも、デメリット **<< メリット** だと思うので、書いていく（書ける方を増やしたい！）

🥟テストコードは良いコードを書く力をつける下地（N=1）
============================================================

* テストコードを書くだけでは良いコードにはならない
* **テストコードは良いコードに近づけるのを助けてくれる**

  * 新しく知った文法を試して書き換えるとき、 誤って振る舞いを変えてしまっても気づける
