.. _PEP 723: https://peps.python.org/pep-0723/
.. _Inline script metadata (Python Packaging User Guide): https://packaging.python.org/en/latest/specifications/inline-script-metadata/

`PEP 723`_ ãŒæ‹“ãä¸–ç•Œ
======================================================================

`Inline script metadata (Python Packaging User Guide)`_

ææ¡ˆçµŒç·¯ï¼ˆPEPã®Motivationã‚ˆã‚Šï¼‰
======================================================================

* å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã® **Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æ—¥å¸¸çš„**
* ãƒ†ã‚­ã‚¹ãƒˆãŒæ›¸ã‘ã‚Œã°å…±æœ‰ã§ãã‚‹ï¼ˆãƒ¡ãƒ¼ãƒ«ã€URLã€ãƒãƒ£ãƒƒãƒˆï¼‰
* ã§ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«å¿…è¦ãªæƒ…å ±ã¯ï¼Ÿ

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«å¿…è¦ãªæƒ…å ±
--------------------------------------------------

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆæ–°ã—ã„æ›¸ãæ–¹ã‚’ã—ã¦ã„ã‚‹ã‹ã‚‚ï¼‰
* ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒä¾å­˜ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ``import`` æ–‡ï¼‰

å®Ÿè¡Œãƒ„ãƒ¼ãƒ«å‘ã‘ã«å®šç¾©ã™ã‚‹ **æ¨™æº–çš„ãªä»•çµ„ã¿ã¯ãªã‹ã£ãŸ**

ææ¡ˆğŸ’¡ Inline script metadata
--------------------------------------------------

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«å¿…è¦ãªæƒ…å ±ï¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
* **ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¸­ã«** ï¼ˆinlineï¼‰ ãƒ„ãƒ¼ãƒ«å‘ã‘ã® **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ã“ã†**

Inline script metadataã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
--------------------------------------------------

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ **ãƒ„ãƒ¼ãƒ«ãŒèª­ã¿å–ã‚‹** ğŸŒŸğŸŒŸ
* å˜ä¸€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ç§»è¡Œã—ã‚„ã™ã
* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾å­˜ã‚’æ‰‹å‹•ã§ç®¡ç†ã—ãªã„ ğŸŒŸğŸŒŸ

Inline script metadataã®æ›¸ãæ–¹
======================================================================

.. code-block:: python

    # /// script
    # dependencies = [
    #   "requests<3",
    #   "rich",
    # ]
    # requires-python = ">=3.11"
    # ///

`How to Teach This (PEP 723) <https://peps.python.org/pep-0723/#how-to-teach-this>`__

Inline script metadataã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†’é ­ã® **ã‚³ãƒ¡ãƒ³ãƒˆ**
------------------------------------------------------------

.. code-block:: python
    :emphasize-lines: 1,7

    # /// script  <-- å§‹ã¾ã‚Š
    # dependencies = [
    #   "requests<3",  <-- é–“ã®éƒ¨åˆ†ã‚‚Pythonå‡¦ç†ç³»ã«ã¨ã£ã¦ã¯ã‚³ãƒ¡ãƒ³ãƒˆ
    #   "rich",
    # ]
    # requires-python = ">=3.11"
    # ///  <-- çµ‚ã‚ã‚Š

2ã¤ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
--------------------------------------------------

* dependencies
* requires-python

`TOML <https://toml.io/ja/>`__ å½¢å¼

dependencies
--------------------------------------------------

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚ã®ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ›¸ã

.. code-block:: python

    # /// script
    # dependencies = ["requests<3", "rich"]
    # ///

* `PEP 508 <https://peps.python.org/pep-0508/#examples>`__ ã®æ›¸ãæ–¹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š

.. code-block::

    requests [security,tests] >= 2.8.1, == 2.8.* ; python_version < "2.7"

requires-python
--------------------------------------------------

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³

.. code-block:: python

    # /// script
    # requires-python = ">=3.11"
    # ///

* `PEP 440ã®version specifier <https://peps.python.org/pep-0440/#version-specifiers>`__ ã§æŒ‡å®š

.. code-block::

    ~= 0.9, >= 1.0, != 1.3.4.*, < 2.0

`PEP 723`_ ã®ä»•æ§˜ã‚„å®Ÿè£…
======================================================================

ã‚‚ã†å°‘ã—ã ã‘æ·±ãè¦‹ã¦ã„ãã¾ã™

å°å…¥ã•ã‚ŒãŸã®ã¯ ``TYPE`` ä»˜ãã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
--------------------------------------------------

.. code-block:: python

    # /// TYPE
    # 
    # ///

* ``TYPE`` ãŒ ``script`` ã®ã¨ãã€inline script metadata
* ï¼ˆè¿½åŠ ã® ``TYPE`` ã‚’ææ¡ˆã§ãã‚‹ã‹ã‚‚ï¼ï¼Ÿï¼‰

inline script metadataã«ã¯ ``[tool]`` ã‚‚æ›¸ã‘ã‚‹
------------------------------------------------------------

* :file:`pyproject.toml` ã§ãŠãªã˜ã¿ ``[tool]`` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`PEP 518 <https://peps.python.org/pep-0518/#tool-table>`__ï¼‰
* inline script metadataã«ã‚‚æ›¸ã‘ã¾ã™ï¼ï¼ˆå¾Œã»ã©ç™»å ´ï¼‰

.. code-block:: toml

    [tool.pytest.ini_options]
    addopts = "-ra -q"

.. https://docs.pytest.org/en/stable/reference/customize.html#pyproject-toml

å®Ÿè£…ä¾‹
------------------------------------------------------------

* **æ­£è¦è¡¨ç¾** ã§ãƒ‘ãƒ¼ã‚¹ã™ã‚‹

.. code-block:: python

    REGEX = r'(?m)^# /// (?P<type>[a-zA-Z0-9-]+)$\s(?P<content>(^#(| .*)$\s)+)^# ///$'

`Reference Implementation (PEP 723) <https://peps.python.org/pep-0723/#reference-implementation>`__

æ­£è¦è¡¨ç¾ã®èª­ã¿è§£ã ğŸƒâ€â™‚ï¸
------------------------------------------------------------

:`(?m) <https://docs.python.org/ja/3/library/re.html#re.M>`__: ãƒãƒ«ãƒãƒ©ã‚¤ãƒ³ã®ãƒ•ãƒ©ã‚°
:`(?P<name>...) <https://docs.python.org/ja/3/library/re.html#index-18>`__: ãƒãƒƒãƒã—ãŸéƒ¨åˆ†æ–‡å­—åˆ—ã« ``name`` ã§ã‚¢ã‚¯ã‚»ã‚¹

``content`` ã¯TOMLãªã®ã§ `tomllib <https://docs.python.org/ja/3/library/tomllib.html>`__ ã§èª­ã¿è¾¼ã¿ã¾ã™

PEP 723ã‚’å®Ÿè£…ã—ã¾ã—ãŸğŸ’ª ğŸƒâ€â™‚ï¸
------------------------------------------------------------

* :fab:`github` `ftnext/pep723 <https://github.com/ftnext/pep723>`__
* inline script metadataã® dependencies ã‚’è¦‹ã¦ä¸€æ™‚çš„ãªä»®æƒ³ç’°å¢ƒã§å®Ÿè¡Œ
* çš†ã•ã‚“ãŒä½¿ã†ãªã‚‰ã“ã®å¾Œç´¹ä»‹ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ãœã²ğŸ§°

ã¾ã¨ã‚ğŸŒ¯ `PEP 723`_ ãŒæ‹“ãä¸–ç•Œ
======================================================================

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«æ›¸ã‘ã‚‹ ``TYPE=script`` ã®metadataã‚’å°å…¥ã—ãŸï¼ˆ*inline script metadata*ï¼‰
* **é–‹ç™ºè€…ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã«å¿…è¦ãªæƒ…å ±ã‚’metadataã«æ›¸ã**
* *ãƒ„ãƒ¼ãƒ«* ãŒmetadataã‚’å‚ç…§ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ

inline script metadataã®æ›¸ãæ–¹
------------------------------------------------------------

.. literalinclude:: metadata_introduction.py
    :language: python
