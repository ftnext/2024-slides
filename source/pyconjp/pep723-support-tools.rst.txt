ä¸–ç•Œã«æ¼•ãå‡ºã™ãƒ„ãƒ¼ãƒ«
======================================================================

* pipx
* uv
* Hatch

ä½¿ã£ã¦ã„ã‚‹æ–¹ï¼ŸğŸ™‹â€â™€ï¸ğŸ™‹ğŸ™‹â€â™‚ï¸

ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆï¼
--------------------------------------------------

* :command:`pipx run`
* :command:`uv run`
* :command:`hatch run`

éŸ¿ã„ãŸãƒ„ãƒ¼ãƒ« **1ã¤**ã€ãœã²ä½¿ã£ã¦

ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ± ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. code-block:: shell

    $ pipx --version
    1.7.1
    % uv --version
    uv 0.4.16 (Homebrew 2024-09-24)
    $ hatch --version
    Hatch, version 1.12.0

pipx
======================================================================

* :fab:`github` `pypa/pipx <https://github.com/pypa/pipx>`__
* Python Packaging User Guide `ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ <https://packaging.python.org/ja/latest/guides/installing-stand-alone-command-line-tools/>`__ ã§ç´¹ä»‹
* 2024/01 `1.4.2 <https://github.com/pypa/pipx/releases/tag/1.4.2>`__ ã§PEP 723ã® ``dependencies`` ã‚’ã‚µãƒãƒ¼ãƒˆ

.. https://github.com/pypa/pipx/pull/1180

pipxã®åˆ©ç”¨ã‚·ãƒ¼ãƒ³
--------------------------------------------------

* IMO *PyPIã‚¢ãƒ—ãƒªã‚¹ãƒˆã‚¢è¨ˆç”»*
* ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã®ä¾‹ `Ruff <https://github.com/astral-sh/ruff>`__ ï¼ˆãƒªãƒ³ã‚¿ãƒ¼ å…¼ ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã€‚``import`` ã—ãªã„ï¼‰
* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã®ä»®æƒ³ç’°å¢ƒã«éƒ½åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ã‚ˆã„ãŒã€**ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ã®ã©ã“ã‹ã‚‰ã§ã‚‚ä½¿ãˆã‚‹** æ–¹ãŒä¾¿åˆ©

pipxè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* https://pipx.pypa.io/stable/installation/
* ç§ã¯ ``brew`` ã§å…¥ã‚Œã¾ã—ãŸ

.. code-block:: shell

    $ python3 -m pip install --user pipx
    $ python3 -m pipx ensurepath  # ãŠå¿˜ã‚Œãªã

è„±ç·š :command:`pipx install` ğŸƒâ€â™‚ï¸
--------------------------------------------------

* ``pipx install ruff`` ï¼ˆ``pip install`` ã®ä»£ã‚ã‚Šã«ï¼‰
* RuffãŒã‚·ã‚¹ãƒ†ãƒ ã®ã©ã“ã‹ã‚‰ã§ã‚‚ä½¿ãˆã‚‹
* pipxã¯ **Ruffç”¨ã®ä»®æƒ³ç’°å¢ƒ** ã‚’ä½œã£ã¦ç®¡ç†ï¼ˆã‚·ã‚¹ãƒ†ãƒ ã¯æ±šã•ãªã„ï¼‰

ã‚‚ã¨ã‚‚ã¨ã® :command:`pipx run`
--------------------------------------------------

* PyPIã«ã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’æŒ‡å®šã—ã¦ **1å›é™ã‚Šã®å®Ÿè¡Œ**
* `cookiecutter <https://github.com/cookiecutter/cookiecutter>`__ ã§1å›ã ã‘ä½¿ã†ï¼ˆ``pipx install`` ã®ä»£æ›¿æ¡ˆï¼‰

.. code-block:: shell

    $ # ref: https://sourcery.ai/blog/python-best-practices/
    $ pipx run cookiecutter https://github.com/ftnext/cookiecutter-develop-pypackage --checkout 0.2.3

.. https://pipx.pypa.io/stable/#walkthrough-running-an-application-in-a-temporary-virtual-environment

``pipx run <script.py>``
--------------------------------------------------

.. https://pipx.pypa.io/stable/docs/#pipx-run

ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ¸¡ã›ã‚‹ã‚ˆã†ã«ï¼

.. code-block:: python

    # /// script
    # dependencies = ["rich"]
    # ///

    import rich
    rich.print("[blue]This worked!")

`Inline run dependencies in pipx 1.4.2 <https://iscinumpy.dev/post/pep723/>`__

ğŸ¥Ÿpipxã€ãŠè©¦ã—ã‚ã‚Œï¼
======================================================================

* https://pipx.pypa.io/stable/installation/
* :command:`pipx run <script.py>`

.. code-block:: python

    # /// script
    # dependencies = ["requests<3", "rich"]
    # ///

``pipx run`` ã¯ **URL** ã‚‚ã‚µãƒãƒ¼ãƒˆï¼ ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. code-block:: shell

    $ pipx run https://gist.githubusercontent.com/ftnext/162898df3011883380f89771b647adde/raw/818fa20479eb9187d9efacb4d291bc959a21cf3a/put_mask.py -h

`ä¸–ç•Œä¸€ã‹ã‚ã„ã„ã‚’ä½œã‚‹ <https://nikkie-ftnext.hatenablog.com/entry/cutest-girl-kotone-with-python>`__ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

pipx é–¢é€£ã‚¨ãƒ³ãƒˆãƒª ğŸƒâ€â™‚ï¸
--------------------------------------------------

* æ‹™ãƒ–ãƒ­ã‚° `PEP 723ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸpipx runã«ã¤ã„ã¦å…±åŒã§ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚ä»®æƒ³ç’°å¢ƒã‹ã‚‰è§£æ”¾ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹ç™ºï¼ <https://nikkie-ftnext.hatenablog.com/entry/announcement-uzabase-tech-blog-filetype-and-pipx-run>`__
* å¼Šç¤¾ãƒ–ãƒ­ã‚° `Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒªãƒ†ã‚£ã¨ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£ã‚’é«˜ã‚ã¦ã„ã <https://tech.uzabase.com/entry/2024/06/07/180442>`__

uv
======================================================================

* :fab:`github` `astral-sh/uv <https://github.com/astral-sh/uv>`__
* Rustã§å®Ÿè£…ã—ãŸé«˜é€Ÿãªpipã¨ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ
* 2024/08 `0.3.0 <https://github.com/astral-sh/uv/releases/tag/0.3.0>`__ ã§ **Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«** ã«åŠ‡çš„é€²åŒ–ã€‚PEP 723ã‚µãƒãƒ¼ãƒˆã‚‚

uvè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* https://docs.astral.sh/uv/getting-started/installation/

.. code-block:: shell

    $ curl -LsSf https://astral.sh/uv/install.sh | sh

ã»ã‹ã€``cargo`` ã‚„ ``brew`` ãªã©ã§ã‚‚å…¥ã‚Šã¾ã™

uvã§Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã®ä¾‹
--------------------------------------------------

.. code-block:: txt

    uv-example/
    â”œâ”€â”€ .venv/
    â”œâ”€â”€ .python-version
    â”œâ”€â”€ example.py
    â”œâ”€â”€ pyproject.toml
    â””â”€â”€ uv.lock

.. code-block:: shell

    $ uv init --app
    $ uv add flask

:command:`uv run <command>`
--------------------------------------------------

* uvã§ç®¡ç†ã—ã¦ã„ã‚‹ **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç’°å¢ƒã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ** ã§ãã‚‹

    * uvã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ä»®æƒ³ç’°å¢ƒ :file:`.venv` ã‚’ä½œã‚Šã€ä¾å­˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

.. code-block:: shell

    $ uv run -- flask run -p 5000

https://docs.astral.sh/uv/guides/projects/#running-commands

``uv run <script.py>`` 1/2
--------------------------------------------------

* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é…ç½®ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ :command:`uv run` ã§å®Ÿè¡Œã§ãã‚‹
* **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»®æƒ³ç’°å¢ƒã§å®Ÿè¡Œ**

.. code-block:: shell

    $ uv run example.py

* :command:`uv run python <script.py>` ã¨ç­‰ä¾¡ï¼ˆ`Reference <https://docs.astral.sh/uv/reference/cli/#uv-run>`__ ã‚ˆã‚Šï¼‰

``uv run <script.py>`` 2/2
--------------------------------------------------

* **inline script metadataã‚’æŒã¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚å®Ÿè¡Œ** ã§ãã‚‹ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é…ç½®ã•ã‚Œã¦ãªãã¦ã‚‚ï¼‰
* `Guides: Running scripts <https://docs.astral.sh/uv/guides/scripts/>`__
* metadataã¯ ``dependencies`` ãƒ» ``requires-python`` ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ
* ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»®æƒ³ç’°å¢ƒã§ãªãï¼‰éš”é›¢ã—ãŸã€çŸ­æœŸé–“é™ã‚Šã®ä»®æƒ³ç’°å¢ƒã‚’uvãŒä½œã£ã¦å®Ÿè¡Œ

.. ã€ŒIf the script contains inline dependency metadata, it will be installed into an isolated, ephemeral environment.ã€
    https://docs.astral.sh/uv/reference/cli/#uv-run

metadataã§uvå‘ã‘ã®toolè¨­å®š
--------------------------------------------------

.. code-block:: python
    :emphasize-lines: 5-6

    # /// script
    # dependencies = [
    #   "httpx",
    # ]
    # [tool.uv]
    # exclude-newer = "2023-10-16T00:00:00Z"
    # ///

uvã¯ ``exclude-newer`` ã‚ˆã‚Šå‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä¾å­˜è§£æ±º

uvã¯metadataã‚’ **æ›¸ã** ãï¼
--------------------------------------------------

.. code-block:: shell

    $ touch empty.py
    $ uv add --script empty.py httpx rich
    Updated `empty.py`

.. literalinclude:: uv_added_script.py

.. ï¼ˆè„±ç·šï¼‰uvã¯åŸºæœ¬æœ€æ–°åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹

ğŸ¥Ÿuvã€ãŠè©¦ã—ã‚ã‚Œï¼
======================================================================

* https://docs.astral.sh/uv/getting-started/installation/
* :command:`uv run <script.py>`

.. code-block:: python

    # /// script
    # requires-python = ">=3.11"
    # dependencies = ["httpx", "rich"]
    # ///

:command:`uvx` (= ``uv tool run``) ğŸƒâ€â™‚ï¸
--------------------------------------------------

* `Guides: Using tools <https://docs.astral.sh/uv/guides/tools/>`__
* ``pipx run`` çš„ãªæ©Ÿèƒ½

    The uvx command invokes a tool without installing it.

uv æ‹™ãƒ–ãƒ­ã‚°é–¢é€£ã‚¨ãƒ³ãƒˆãƒª ğŸƒâ€â™‚ï¸
--------------------------------------------------

* `uv 0.3.0ãƒªãƒªãƒ¼ã‚¹ã€Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã®ã™ãŒãŸï¼ uvã€ãŠå‰ã€Ryeã‚’å± ã‚‹ã®ã‹... <https://nikkie-ftnext.hatenablog.com/entry/uv-0.3.0-release-awesome-future-python-project-package-manager>`__
* `uvã¯inline script metadataã‚’æ›¸ã‘ã‚‹ï¼ Guidesã®ã€ŒRunning scriptsã€ã‚’èª­ã‚“ã ãƒ¡ãƒ¢ <https://nikkie-ftnext.hatenablog.com/entry/uv-guides-running-scripts-add-inline-script-metadata>`__
* `uv 0.4.0 ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚ˆã‚Šã€Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‰±ã„ã®å¤‰æ›´ã€‚å†é…å¸ƒå¯èƒ½ã«ã™ã‚‹ã‹ã‚’--appã‚„--libãƒ•ãƒ©ã‚°ã§æŒ‡å®šã™ã‚‹ <https://nikkie-ftnext.hatenablog.com/entry/uv-0.4.0-specify-distributable-flag-app-or-lib>`__

Hatch
======================================================================

* :fab:`github` `pypa/hatch <https://github.com/pypa/hatch>`__
* Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«
* 2024/05 `1.10.0 <https://hatch.pypa.io/latest/blog/2024/05/02/hatch-v1100/>`__ ã§ :command:`hatch run` ãŒPEP 723ã‚µãƒãƒ¼ãƒˆ

IMO: Hatch vs uv ğŸƒâ€â™‚ï¸
--------------------------------------------------

* ã©ã¡ã‚‰ã‚‚Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã¨èªè­˜ã—ã¦ã„ã‚‹
* uvã¯ã‚ã¡ã‚ƒã‚ã¡ã‚ƒæ³¨ç›®ã•ã‚Œã¦ã„ã‚‹å°è±¡
* Hatchã¯æ‰‹åšã„ã€‚ç¾åœ¨ã®æ©Ÿèƒ½å·®ã¯ã€Hatchãªã‚‰ **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Pythoné–‹ç™ºã®ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹** ç‚¹ã¨æ˜ ã‚‹

ã“ã‚Œä»¥ä¸Šçªã£è¾¼ã‚“ã è©±ã¯å»Šä¸‹ã§æ•ã¾ãˆã¦ãã ã•ã„ï¼ˆå¤§æ­“è¿ï¼‰

Hatchè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* https://hatch.pypa.io/latest/install/
* macOSãƒ»Windowså‘ã‘ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©
* pipã‚„pipxã€brewãªã©ã§ã‚‚å…¥ã‚Šã¾ã™

ã‚‚ã¨ã‚‚ã¨ã® :command:`hatch run`
--------------------------------------------------

* :file:`pyproject.toml` ã« *env* ã”ã¨ã«å®šç¾©ã—ãŸ *script* ã‚’å®Ÿè¡Œã™ã‚‹

.. code-block:: toml

    [tool.hatch.envs.types.scripts]
    check = "mypy --install-types --non-interactive {args:src/unko tests}"

.. code-block:: shell

    $ hatch run types:check  # types envã®check scriptå®Ÿè¡Œ

``hatch run <script.py>``
--------------------------------------------------

* `How to run Python scripts <https://hatch.pypa.io/latest/how-to/run/python-scripts/>`__
* :file:`pyproject.toml` ã®scriptã ã‘ã§ãªãã€**Pythonãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æ¸¡ã—ã¦å®Ÿè¡Œã§ãã‚‹** ã‚ˆã†ã«ãªã£ãŸï¼
* metadataã¯ ``dependencies`` ãƒ» ``requires-python`` ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ

metadataã§Hatchå‘ã‘ã®toolè¨­å®š
--------------------------------------------------

Hatchã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã¨ã—ã¦ï¼ˆuvã§ã¯ãªãï¼‰pipã‚’ä½¿ã†

.. code-block:: python

    # /// script
    # ...
    # [tool.hatch]
    # installer = "pip"
    # ///

.. https://hatch.pypa.io/latest/how-to/run/python-scripts/#environment-configuration

ğŸ¥ŸHatchã€ãŠè©¦ã—ã‚ã‚Œ
======================================================================

* https://hatch.pypa.io/latest/install/
* :command:`hatch run <script.py>`

.. code-block:: python

    # /// script
    # requires-python = ">=3.11"
    # dependencies = ["httpx", "rich"]
    # ///

Hatch å‚è€ƒ ğŸƒâ€â™‚ï¸
--------------------------------------------------

* Python Monthly Topics `æœ€è¿‘æ°—ã«ãªã‚‹ãƒ„ãƒ¼ãƒ«ã€ŒHatchã€ã§Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†ã™ã‚‹ <https://gihyo.jp/article/2024/05/monthly-python-2405>`__
* æ‹™ãƒ–ãƒ­ã‚° `Hatchã¯v1.10ã‹ã‚‰inline script metadataã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼ <https://nikkie-ftnext.hatenablog.com/entry/hatch-v1.10-supports-inline-script-metadata>`__

ã¾ã¨ã‚ğŸŒ¯ ä¸–ç•Œã«æ¼•ãå‡ºã™ãƒ„ãƒ¼ãƒ«
======================================================================

.. list-table::
    :header-rows: 1

    * - \\
      - dependencies
      - requires-python
      - ``[tool]``      
    * - pipx
      - âœ…
      - æœª
      - æœª
    * - uv
      - âœ…
      - âœ…
      - âœ…
    * - Hatch
      - âœ…
      - âœ…
      - âœ…

:command:`uv add --script` ã§æ›¸ã‘ã‚‹ï¼

ã‚µãƒãƒ¼ãƒˆçŠ¶æ³ã®æ™‚ç³»åˆ— ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. list-table::
    :header-rows: 1

    * - æ™‚æœŸ
      - ãƒ„ãƒ¼ãƒ«
      - ãƒãƒ¼ã‚¸ãƒ§ãƒ³
    * - 2024/01
      - pipx
      - 1.4.2
    * - 2024/05
      - Hatch
      - 1.10.0
    * - 2024/08
      - uv
      - 0.3.0

ã»ã‹ã«ã‚‚ ğŸƒâ€â™‚ï¸
======================================================================

* PDM 2024/06 `2.16.0 <https://github.com/pdm-project/pdm/releases/tag/2.16.0>`__ ã€œ

  * https://pdm-project.org/en/latest/usage/scripts/#single-file-scripts

* `pip-run <https://github.com/jaraco/pip-run?tab=readme-ov-file#script-declared-dependencies>`__

PEP 723ã‚µãƒãƒ¼ãƒˆã®å‹•ã ğŸƒâ€â™‚ï¸
--------------------------------------------------

* pip `#12891 <https://github.com/pypa/pip/issues/12891>`__

  * ``pip install --script script.py`` ã§metadataã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„ï¼ˆãƒ—ãƒ«ãƒªã‚¯å¾…ã¡ï¼‰

* poetryã‚„pipenvã¯ãƒªãƒã‚¸ãƒˆãƒªã‚’æ¤œç´¢ã—ã¦ã‚‚è¦‹ã¤ã‘ã‚‰ã‚ŒãšğŸ˜¢ï¼ˆæƒ…å ±æ±‚ãƒ ï¼‰
