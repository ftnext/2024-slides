ä¸–ç•Œã«æ¼•ãå‡ºã™ãƒ„ãƒ¼ãƒ«
======================================================================

* pipx
* uv
* Hatch

ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆï¼
--------------------------------------------------

* :command:`pipx run`
* :command:`uv run`
* :command:`hatch run`

ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ± ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. code-block:: shell

    $ pipx --version
    1.7.1
    $ uv --version
    uv 0.4.12 (Homebrew 2024-09-18)
    $ hatch --version
    Hatch, version 1.12.0

.. TODO ãªã‚‹ã¹ãæœ€æ–°ã§

pipx
======================================================================

* :fab:`github` `pypa/pipx <https://github.com/pypa/pipx>`__
* Python Packaging User Guide `ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ <https://packaging.python.org/ja/latest/guides/installing-stand-alone-command-line-tools/>`__ ã§ç´¹ä»‹
* 2024/01 `1.4.2 <https://github.com/pypa/pipx/releases/tag/1.4.2>`__ ã§PEP 723ã® ``dependencies`` ã‚’ã‚µãƒãƒ¼ãƒˆ

.. https://github.com/pypa/pipx/pull/1180

pipxã®åˆ©ç”¨ã‚·ãƒ¼ãƒ³
--------------------------------------------------

* ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã®ä¾‹ `Ruff <https://github.com/astral-sh/ruff>`__ ï¼ˆãƒªãƒ³ã‚¿ãƒ¼ å…¼ ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ï¼‰
* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã®ä»®æƒ³ç’°å¢ƒã«éƒ½åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ã‚ˆã„ãŒã€**ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ã®ã©ã“ã‹ã‚‰ã§ã‚‚ä½¿ãˆã‚‹** æ–¹ãŒä¾¿åˆ©

pipxè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* https://pipx.pypa.io/stable/installation/
* ç§ã¯ ``brew`` ã§å…¥ã‚Œã¾ã—ãŸ

.. code-block:: shell

    $ python3 -m pip install --user pipx
    $ python3 -m pipx ensurepath  # ãŠå¿˜ã‚Œãªã

è„±ç·š :command:`pipx install` ğŸƒâ€â™‚ï¸
--------------------------------------------------

* ``pipx install ruff``
* RuffãŒã‚·ã‚¹ãƒ†ãƒ ã®ã©ã“ã‹ã‚‰ã§ã‚‚ä½¿ãˆã‚‹
* pipxã¯ **Ruffç”¨ã®ä»®æƒ³ç’°å¢ƒ** ã‚’ä½œã£ã¦ç®¡ç†

ã‚‚ã¨ã‚‚ã¨ã® :command:`pipx run`
--------------------------------------------------

* Pythonã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®1å›é™ã‚Šã®å®Ÿè¡Œ
* `cookiecutter <https://github.com/cookiecutter/cookiecutter>`__ ã§1å›ã ã‘ä½¿ã†ï¼ˆ``pipx install`` ã®é¸æŠè‚¢ï¼‰

.. TODO è‡ªä½œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã‚ˆã†

.. https://pipx.pypa.io/stable/#walkthrough-running-an-application-in-a-temporary-virtual-environment

``pipx run <script.py>``
--------------------------------------------------

.. https://pipx.pypa.io/stable/docs/#pipx-run

ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ¸¡ã›ã‚‹ã‚ˆã†ã«ï¼

.. code-block:: python

    # /// script
    # dependencies = ["rich"]
    # ///

    import rich
    rich.print("[blue]This worked!")

`Inline run dependencies in pipx 1.4.2 <https://iscinumpy.dev/post/pep723/>`__

.. TODO ç”»åƒã§ç¤ºã™

ğŸ¥Ÿpipxã¨PEP 723
--------------------------------------------------

* pipx 1.4.2 ã‹ã‚‰ :command:`pipx run` ãŒinline script metadataã‚‚ã‚µãƒãƒ¼ãƒˆï¼ˆ**dependenciesã®ã¿**ï¼‰
* pipxè‡ªä½“ã¯Pythonè£½ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’æ±šã•ãšã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«

  * *PyPIã‚¢ãƒ—ãƒªã‚¹ãƒˆã‚¢è¨ˆç”»*

.. TODO URLã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã§ãã‚‹ã‹ã‚‚

uv
======================================================================

* :fab:`github` `astral-sh/uv <https://github.com/astral-sh/uv>`__
* Rustã§å®Ÿè£…ã—ãŸé«˜é€Ÿãªpipã¨ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ
* 2024/08 `0.3.0 <https://github.com/astral-sh/uv/releases/tag/0.3.0>`__ ã§ **Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«** ã«åŠ‡çš„é€²åŒ–ã€‚PEP 723ã‚µãƒãƒ¼ãƒˆã‚‚

uvè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* https://docs.astral.sh/uv/getting-started/installation/

.. code-block:: shell

    $ curl -LsSf https://astral.sh/uv/install.sh | sh

ã»ã‹ã€``cargo`` ã‚„ ``brew`` ãªã©ã§ã‚‚å…¥ã‚Šã¾ã™

:command:`uv run <command>`
--------------------------------------------------

* uvã§ç®¡ç†ã—ã¦ã„ã‚‹ **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç’°å¢ƒã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ** ã§ãã‚‹

    * uvã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ä»®æƒ³ç’°å¢ƒ :file:`.venv` ã‚’ä½œã‚Šã€ä¾å­˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

.. code-block:: shell

    $ uv run -- flask run -p 5000

https://docs.astral.sh/uv/guides/projects/#running-commands

``uv run <script.py>`` 1/2
--------------------------------------------------

* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é…ç½®ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ :command:`uv run` ã§å®Ÿè¡Œã§ãã‚‹
* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»®æƒ³ç’°å¢ƒã§å®Ÿè¡Œ

.. code-block:: shell

    $ uv run example.py

* :command:`uv run python <script.py>` ã¨ç­‰ä¾¡ï¼ˆ`Reference <https://docs.astral.sh/uv/reference/cli/#uv-run>`__ ã‚ˆã‚Šï¼‰

``uv run <script.py>`` 2/2
--------------------------------------------------

* uvã§ç®¡ç†ã—ã¦ã„ã‚‹ **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ç„¡é–¢ä¿‚ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚å®Ÿè¡Œã§ãã‚‹**
* `Guides: Running scripts <https://docs.astral.sh/uv/guides/scripts/>`__
* inline script metadataãŒã‚ã‚Œã°ã€ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»®æƒ³ç’°å¢ƒã§ãªãï¼‰ **éš”é›¢ã—ãŸã€çŸ­æœŸé–“é™ã‚Šã®ä»®æƒ³ç’°å¢ƒ** ã‚’uvãŒä½œã£ã¦å®Ÿè¡Œ
* metadataã¯ ``dependencies`` ãƒ» ``requires-python`` ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ

.. ã€ŒIf the script contains inline dependency metadata, it will be installed into an isolated, ephemeral environment.ã€
    https://docs.astral.sh/uv/reference/cli/#uv-run

metadataã§uvå‘ã‘ã®toolè¨­å®š
--------------------------------------------------

.. code-block:: python
    :emphasize-lines: 5-6

    # /// script
    # dependencies = [
    #   "httpx",
    # ]
    # [tool.uv]
    # exclude-newer = "2023-10-16T00:00:00Z"
    # ///

uvã¯ ``exclude-newer`` ã‚ˆã‚Šå‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä¾å­˜è§£æ±º

uvã¯metadataã‚’ **æ›¸ã** ãï¼
--------------------------------------------------

.. code-block:: shell

    $ touch empty.py
    $ uv add --script empty.py httpx rich
    Updated `empty.py`

.. literalinclude:: uv_added_script.py

.. ï¼ˆè„±ç·šï¼‰uvã¯åŸºæœ¬æœ€æ–°åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹

.. ï¼ˆpyproject.tomlã®é€šã‚Šã®ç’°å¢ƒã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚inline script metadataãŒã‚ã‚Œã°éš”é›¢ã—ãŸç’°å¢ƒã‚’ä½œã‚‹ï¼‰

.. ï¼ˆTODO ã“ã®ç’°å¢ƒã€å†åˆ©ç”¨ã•ã‚Œã¦ãã†ã«æ€ã‚ã‚Œã‚‹ï¼‰

ğŸ¥Ÿuvã¨PEP 723
--------------------------------------------------

* uv 0.3.0 ã‹ã‚‰ :command:`uv run` ãŒinline script metadataã‚’è€ƒæ…®ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹
* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®metadataã‚‚ç·¨é›†ã§ãã‚‹
* IMOï¼šuvè‡ªä½“ã¯Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç®¡ç†ãŒä¸»çœ¼ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ç„¡é–¢ä¿‚ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã‚‚ã§ãã¦ã„ã‚‹

.. uvx ğŸƒâ€â™‚ï¸

Hatch
======================================================================

* :fab:`github` `pypa/hatch <https://github.com/pypa/hatch>`__
* Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã€‚æ‰‹åšã„
* 2024/05 `1.10.0 <https://hatch.pypa.io/latest/blog/2024/05/02/hatch-v1100/>`__ ã§ :command:`hatch run` ãŒPEP 723ã‚µãƒãƒ¼ãƒˆ

.. TODO Hatch vs uv (IMO) ğŸƒâ€â™‚ï¸
    è©³ã—ãã¯å»Šä¸‹ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„

Hatchè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* https://hatch.pypa.io/latest/install/
* macOSãƒ»Windowså‘ã‘ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©
* pipã‚„pipxã€brewãªã©ã§ã‚‚å…¥ã‚Šã¾ã™

ã‚‚ã¨ã‚‚ã¨ã® :command:`hatch run`
--------------------------------------------------

* :file:`pyproject.toml` ã« *env* ã”ã¨ã«å®šç¾©ã—ãŸ *script* ã‚’å®Ÿè¡Œã™ã‚‹

.. code-block:: toml

    [tool.hatch.envs.types.scripts]
    check = "mypy --install-types --non-interactive {args:src/unko tests}"

.. code-block:: shell

    $ hatch run types:check  # types envã®check scriptå®Ÿè¡Œ

``hatch run <script.py>``
--------------------------------------------------

* `How to run Python scripts <https://hatch.pypa.io/latest/how-to/run/python-scripts/>`__
* :file:`pyproject.toml` ã®scriptã ã‘ã§ãªãã€**Pythonãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æ¸¡ã—ã¦å®Ÿè¡Œã§ãã‚‹** ã‚ˆã†ã«ãªã£ãŸï¼
* metadataã¯ ``dependencies`` ãƒ» ``requires-python`` ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ

metadataã§Hatchå‘ã‘ã®toolè¨­å®š
--------------------------------------------------

Hatchã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã¨ã—ã¦ï¼ˆuvã§ã¯ãªãï¼‰pipã‚’ä½¿ã†

.. code-block:: python

    # /// script
    # ...
    # [tool.hatch]
    # installer = "pip"
    # ///

.. https://hatch.pypa.io/latest/how-to/run/python-scripts/#environment-configuration

ğŸ¥ŸHatchã¨PEP 723
--------------------------------------------------

* Hatch 1.10.0 ã‹ã‚‰ :command:`hatch run` ãŒã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã‚‚ã‚µãƒãƒ¼ãƒˆï¼ˆinline script metadataã‚’è€ƒæ…®ï¼‰
* IMOï¼šHatchè‡ªä½“ã¯Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç®¡ç†ãŒä¸»çœ¼ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ç„¡é–¢ä¿‚ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã‚‚ã‚µãƒãƒ¼ãƒˆã—ãŸ

ã¾ã¨ã‚ğŸŒ¯ ä¸–ç•Œã«æ¼•ãå‡ºã™ãƒ„ãƒ¼ãƒ«
======================================================================

* pipx: metadataã¯dependenciesã®ã¿ã‚µãƒãƒ¼ãƒˆ
* uv: Pythonãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¸¡ã™ã¨ **ã‚³ãƒãƒ³ãƒ‰** ``python script.py`` ã¨ã—ã¦å®Ÿè¡Œã€‚toolãƒ†ãƒ¼ãƒ–ãƒ«ã§è¨­å®šå¯èƒ½
* hatch: Pythonãƒ•ã‚¡ã‚¤ãƒ«ãŒæ¸¡ã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚toolãƒ†ãƒ¼ãƒ–ãƒ«ã§è¨­å®šå¯èƒ½

ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹metadata
--------------------------------------------------

.. list-table::
    :header-rows: 1

    * - \\
      - dependencies
      - requires-python
      - ``[tool]``      
    * - pipx
      - âœ…
      - æœª
      - æœª
    * - uv
      - âœ…
      - âœ…
      - âœ…
    * - Hatch
      - âœ…
      - âœ…
      - âœ…

ã‚µãƒãƒ¼ãƒˆçŠ¶æ³ã®æ™‚ç³»åˆ— ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. list-table::
    :header-rows: 1

    * - æ™‚æœŸ
      - ãƒ„ãƒ¼ãƒ«
      - ãƒãƒ¼ã‚¸ãƒ§ãƒ³
    * - 2024/01
      - pipx
      - 1.4.2
    * - 2024/05
      - Hatch
      - 1.10.0
    * - 2024/08
      - uv
      - 0.3.0

ã»ã‹ã«ã‚‚ ğŸƒâ€â™‚ï¸
======================================================================

* PDM 2024/06 `2.16.0 <https://github.com/pdm-project/pdm/releases/tag/2.16.0>`__ ã€œ

  * https://pdm-project.org/en/latest/usage/scripts/#single-file-scripts

* `pip-run <https://github.com/jaraco/pip-run?tab=readme-ov-file#script-declared-dependencies>`__

PEP 723ã‚µãƒãƒ¼ãƒˆã®å‹•ã ğŸƒâ€â™‚ï¸
--------------------------------------------------

* pip `#12891 <https://github.com/pypa/pip/issues/12891>`__

  * ``pip install --script script.py`` ã§metadataã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„ï¼ˆãƒ—ãƒ«ãƒªã‚¯å¾…ã¡ï¼‰

* poetryã‚„pipenvã¯ãƒªãƒã‚¸ãƒˆãƒªã‚’æ¤œç´¢ã—ã¦ã‚‚è¦‹ã¤ã‘ã‚‰ã‚ŒãšğŸ˜¢ï¼ˆæƒ…å ±æ±‚ãƒ ï¼‰
