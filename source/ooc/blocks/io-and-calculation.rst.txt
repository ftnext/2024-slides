2ï¸âƒ£å…¥å‡ºåŠ›ã¨è¨ˆç®—ã‚’ **åˆ†ã‘ã‚‹**
======================================================================

åˆ†ã‘ã¦å°ã•ãã€å†åˆ©ç”¨ã—ã‚„ã™ã

è¨ˆç®—çµæœã‚’æ›¸ãè¾¼ã‚€å‡¦ç†ï¼ˆæ‚ªã—ãä¾‹ï¼‰
--------------------------------------------------

.. code-block:: python
    :linenos:

    def save_result(data, file_path):
        result = []
        for obj in data:
            # å®Ÿéš›ã¯ã€summaryã®æœ«å°¾ã«å¥ç‚¹ã€Œã€‚ã€ãŒãªã‘ã‚Œã°è£œã†ãªã©ã‚‚å…¥ã£ã¦ãã¾ã™
            result.append({"text": obj["summary"] + obj["detail"]})

        with jsonlines.open(file_path, "w") as writer:
            writer.write_all(result)

å‚è€ƒä¾‹ï¼šã‚¯ãƒ©ã‚¹ã®å ´åˆ
--------------------------------------------------

.. code-block:: python
    :linenos:

    class DataCollection:
        def __init__(self, data):
            self.data = data

        def save(self, file_path):
            result = []
            for obj in self.data:
                result.append({"text": obj["summary"] + obj["detail"]})

            with jsonlines.open(file_path, "w") as writer:
                writer.write_all(result)

.. saveã«ä½¿ã†ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã—ã¦ã„ãã‚ˆã†ã«ç™ºå±•ã—ãã†

å°‘ã—å¾Œã«ãªã£ã¦
--------------------------------------------------

* ã€Œä»Šã‹ã‚‰å®Ÿè£…ã™ã‚‹å‡¦ç†ã€å‰ã«ä½œã£ãŸ ``save_result()`` ã¨ **åŒã˜è¨ˆç®—** ãŒå‡ºã¦ãã‚‹ã€‚ãã®è¨ˆç®—çµæœã‚’ã•ã‚‰ã«è¨ˆç®—ã™ã‚‹ã®ã‹ã€
* ã€Œ ``save_result()`` ä½¿ãˆã°æœ€åˆã®è¨ˆç®—ã¯ã§ãã‚‹ãªã€‚ã‚ã‚Œã€ã“ã‚Œãªã‚“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã¾ã§ã™ã‚‹ã®ï¼Ÿ ä½™è¨ˆã€œã€

å®Ÿã¯ãƒ†ã‚¹ãƒˆã‚‚æ›¸ãã¥ã‚‰ã‹ã£ãŸ
--------------------------------------------------

.. code-block:: python
    :linenos:

    @patch("(Pythonã®è©³ç´°ãªã®ã§ç•¥).jsonlines")
    def test_save_result(jsonlines):  # æ›¸ãè¾¼ã¾ãªã„ã‚ˆã†ãƒ¢ãƒƒã‚¯ã«ã™ã‚‹
        writer = jsonlines.open.return_value.__enter__.return_value
        data = [
            # å®Ÿéš›ã¯summaryã‚„detailä»¥å¤–ã®é …ç›®ã‚‚å«ã¿ã¾ã™
            {"summary": "ã™ã”ã„è¦ç´„ã€‚", "detail": "ã‹ãã‹ãã—ã‹ã˜ã‹ã€ã»ã’ã»ã’ãµãŒãµãŒ"},
            {"summary": "ä»ŠåŒ—ç”£æ¥­", "detail": "..."},
        ]

        save_result(data, file_path)

        writer.write_all.assert_called_once_with(
            [
                {"text": "ã™ã”ã„è¦ç´„ã€‚ã‹ãã‹ãã—ã‹ã˜ã‹ã€ã»ã’ã»ã’ãµãŒãµãŒ"},
                {"text": "ä»ŠåŒ—ç”£æ¥­ã€‚..."},
            ]
        )

è¨ˆç®—ã—ã¦ä¿å­˜ã™ã‚‹é–¢æ•°ã‚’æ›¸ã„ã¦ã„ãŸç§
--------------------------------------------------

* **è¨ˆç®—éƒ¨åˆ†ã ã‘å†åˆ©ç”¨ã§ããªã„** ï¼ˆä¿å­˜ãŒä½™è¨ˆï¼‰
* ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯ãƒ‡ãƒ¼ã‚¿ã¨ãã®è¨ˆç®—çµæœã‚’å«ã‚€ã®ã§ã€ç¸¦ã«é•·ããªã‚‹

ğŸ§­å…¥å‡ºåŠ›ã¨è¨ˆç®—åˆ¤æ–­ã‚’åˆ†ã‘ã‚‹
--------------------------------------------------

.. raw:: html

    <iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" frameborder="0" src="https://speakerdeck.com/player/d663c3f2afec45379371126260431048?slide=12" title="ã“ã‚Œã ã‘ã¯çŸ¥ã£ã¦ãŠããŸã„ã‚¯ãƒ©ã‚¹è¨­è¨ˆã®åŸºç¤çŸ¥è­˜" allowfullscreen="true" data-ratio="1.7777777777777777"></iframe>

è¨ˆç®—ã¨å‡ºåŠ›ã‚’åˆ†ã‘ã¦æ›¸ã
--------------------------------------------------

.. code-block:: python
    :linenos:

    def calculate(data):  # ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
        result = []
        for obj in data:
            result.append({"text": obj["summary"] + obj["detail"]})
        return result

    def write(file_path, data):  # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å‡¦ç†
        with jsonlines.open(file_path, "w") as writer:
            writer.write_all(data)

    # calculateã—ã¦writeã™ã‚‹ã¨ã—ã¦ã€å…ˆã®save_resultã‚’å®Ÿç¾

å…¥å‡ºåŠ›ã¨è¨ˆç®—åˆ¤æ–­ã‚’åˆ†ã‘ãŸå®Ÿè£…
--------------------------------------------------

* **è¨ˆç®—** ã§ã¯ **ãƒ¡ãƒ¢ãƒªä¸Šã®ãƒ‡ãƒ¼ã‚¿** ã‚’æ‰±ã†ã€‚å†åˆ©ç”¨ã—ã‚„ã™ã„
* æ°¸ç¶šåŒ–ã¯å‡ºåŠ›å‡¦ç†ã§æ‹…ã†ã€‚è¨ˆç®—ã¯æ°—ã«ã—ãªãã¦ã‚ˆã„ï¼ˆå‡ºåŠ›å½¢å¼ã®å¤‰æ›´ã‚‚å¯¾å¿œã§ãã‚‹ï¼‰
* å°ã•ãåˆ†ã‹ã‚ŒãŸã®ã§ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚‚æ›¸ãã‚„ã™ã„

ãµã‚Šã‹ãˆã‚‹ã¨ã€æ³¨ç›®ã™ã¹ãç®‡æ‰€ãŒè¦‹ãˆã¦ã„ãªã‹ã£ãŸ
--------------------------------------------------

* ã‚³ãƒ¼ãƒ‰ã®è¡Œæ•°ã«æ³¨ç›®ã—ã¦ã„ãŸï¼ˆNè¡Œãã‚‰ã„ã ã‹ã‚‰é–¢æ•°ã«ã—ã‚ˆã†ï¼‰
* ã‚³ãƒ¼ãƒ‰ã® **ç›®çš„** ï¼ˆå…¥å‡ºåŠ›ã€è¨ˆç®—åˆ¤æ–­ï¼‰ã«ç›²ç›®ã§ã—ãŸ
* æ··ãœã¦ã„ãŸã®ã§ã€è¨ˆç®—ã ã‘ä½¿ãˆãªã„

å…¥å‡ºåŠ›ã¨è¨ˆç®—åˆ¤æ–­ã‚’åˆ†ã‘ã¦ã„ã
--------------------------------------------------

éå»ã®è‡ªåˆ†ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã

* `é–¢æ•°ã®æŠ½å‡º <https://refactoring.com/catalog/extractFunction.html>`__
* `é–¢æ•°ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ– <https://refactoring.com/catalog/inlineFunction.html>`__

ç›®çš„ã”ã¨ã«é–¢æ•°ã« **æŠ½å‡º**
--------------------------------------------------

.. code-block:: python
    :linenos:

    def save_result(data, file_path):
        result = calculate(data)
        write(result, file_path)

    def calculate(data):
        result = []
        for obj in data:
            result.append({"text": obj["summary"] + obj["detail"]})
        return result

    def write(file_path, data):
        with jsonlines.open(file_path, "w") as writer:
            writer.write_all(data)

å…ƒã®é–¢æ•°ã‚’ **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–**
--------------------------------------------------

.. code-block:: python

    # save_resultã‚’å‘¼ã³å‡ºã—ã¦ã„ãŸç®‡æ‰€ï¼ˆå‘¼ã³å‡ºã—ãŒãªããªã‚‹ï¼‰
    result = calculate(data)
    write(result, file_path)

å‚è€ƒï¼š **åŸºæœ¬** ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã§ãã¡ã‚ƒã„ã¾ã™
------------------------------------------------------------

ã€`ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆç¬¬2ç‰ˆï¼‰ <https://www.ohmsha.co.jp/book/9784274224546/>`__ã€6ç« ã€Œãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¯ã˜ã‚ã®ä¸€æ­©ã€

* é–¢æ•°ã®æŠ½å‡º
* é–¢æ•°ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–
* é–¢æ•°å®£è¨€ã®å¤‰æ›´ï¼ˆå¾Œè¿°ï¼‰
