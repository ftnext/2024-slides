pip-toolsã®ææ¡ˆ
======================================================================

ä»®æƒ³ç’°å¢ƒ â¤ï¸ pip-tools

transitiveãªä¾å­˜ã®ç®¡ç†ã®ãƒ„ãƒ©ã•ã‚’ã©ã†è§£æ±ºã™ã‚‹ã‹
--------------------------------------------------

* Poetryã‚„Pipenvãªã©ã® **å¼·åŠ›** ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†æ©Ÿèƒ½ã‚’æŒã£ãŸãƒ„ãƒ¼ãƒ«ğŸ‘
* ã²ã­ãã‚ŒãŸnikkieã€Œãã“ã¾ã§æŒã¡å‡ºã•ãªãã¦ã‚‚ã§ããªã„ã‹ãªã€ï¼ˆã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã®å…¨éƒ¨ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã‚ã‘ã˜ã‚ƒãªã„ã—ï¼‰

ãã“ã§ã€**pip-tools**
--------------------------------------------------

* RyeãŒä½¿ã£ã¦ã„ã¦çŸ¥ã£ãŸï¼ˆå¾Œè¿°ï¼‰
* **transitiveãªä¾å­˜ã®ç®¡ç†** ã‚’ã†ã¾ãè§£æ±ºã—ã¦ã„ã‚‹ã‚ˆã†ã«æ„Ÿã˜ã‚‹ï¼ˆæœ¬ç™ºè¡¨ã§ææ¡ˆï¼‰

pip-tools
======================================================================

https://pypi.org/project/pip-tools/

    pip-tools = pip-compile + pip-sync

**2ã¤ã®ã‚³ãƒãƒ³ãƒ‰** ã‚’æä¾›
--------------------------------------------------

.. image:: ../_static/pyconkyushu/pip-tools-overview.svg

å¼•ç”¨å…ƒ https://github.com/jazzband/pip-tools/blob/7.4.1/img/pip-tools-overview.svg

1ï¸âƒ£ :command:`pip-compile`
--------------------------------------------------

* é–‹ç™ºè€…ã¯ **directãªä¾å­˜ã ã‘** ã‚’æŒ‡å®šã™ã‚‹

  * :file:`requirements.in`
  * :file:`pyproject.toml`

* ``pip-compile`` ãŒï¼ˆ``pip freeze`` åŒæ§˜ã®ï¼‰ :file:`requirements.txt` ã‚’ä½œã£ã¦ãã‚Œã‚‹

:command:`pip-compile` ã®ä¾‹
--------------------------------------------------

.. code-block:: shell

    % cat requirements.in
    transformers
    rouge-score
    % pip-compile

2ï¸âƒ£ :command:`pip-sync`
--------------------------------------------------

* ä»®æƒ³ç’°å¢ƒã‚’ :file:`requirements.txt` ã¨ **åŒæœŸ**

.. code-block:: shell

    % pip-sync --python-executable .venv/bin/python

ğŸ¥Ÿpip-toolsã‚’ä½¿ã£ãŸä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†
--------------------------------------------------

1. é–‹ç™ºè€…ãŒdirectãªä¾å­˜ã‚’æŒ‡å®šï¼ˆ:file:`requirements.in` ã‚„ :file:`pyproject.toml` ãªã©ï¼‰
2. :command:`pip-compile` ã§ :file:`requirements.txt` ã‚’è‡ªå‹•ç”Ÿæˆ
3. :command:`pip-sync` ã§ä»®æƒ³ç’°å¢ƒã‚’ :file:`requirements.txt` ã¨åŒæœŸ

å†æ²
--------------------------------------------------

.. image:: ../_static/pyconkyushu/pip-tools-overview.svg

transitiveãªä¾å­˜ã®ç®¡ç†ã®èª²é¡Œã«å¯¾ã—ã¦
======================================================================

.. code-block:: shell

    % cat requirements.in
    transformers
    rouge-score
    % pip-compile
    % pip-sync --python-executable .venv/bin/python

rouge-scoreã¯ä½¿ã‚ãªã„ã“ã¨ã«
--------------------------------------------------

.. code-block:: shell

    % cat requirements.in  # é–‹ç™ºè€…ãŒç·¨é›†ã—ãŸå¾Œ
    transformers
    % pip-compile
    % pip-sync --python-executable .venv/bin/python

rouge-scoreã ã‘ãŒä¾å­˜ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚æ¶ˆãˆãŸï¼
--------------------------------------------------

.. code-block:: shell

    % pip-sync --python-executable .venv/bin/python

    Found existing installation: rouge_score 0.1.2
    Uninstalling rouge_score-0.1.2:
      Successfully uninstalled rouge_score-0.1.2
    Found existing installation: six 1.16.0
    Uninstalling six-1.16.0:
      Successfully uninstalled six-1.16.0

å‡ºåŠ›ã®ä¸€éƒ¨æŠœç²‹

pip-toolsåˆ©ç”¨ã‚·ãƒ¼ãƒ³ã‚ˆã‚Š
======================================================================

* ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒªãƒã‚¸ãƒˆãƒª `2024-slides <https://github.com/ftnext/2024-slides>`__ ğŸ‘ˆ
* Djangoã®ç·´ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ `djoser-practice <https://github.com/ftnext/djoser-practice>`__

dependabotãŒæ•™ãˆã¦ãã‚Œã‚‹
--------------------------------------------------

* ç›´è¿‘ã§ã€Œrequestsã‚’ **2.32.0ä»¥ä¸Š** ã«ã—ã‚ˆã†ã€
* `Session object does not verify requests after making first request with verify=False (Severity Moderate) <https://github.com/psf/requests/security/advisories/GHSA-9wx4-h78v-vm56>`__
* requestsã¯ã€transitiveãªä¾å­˜ã«ã‚ãŸã‚‹

ç‰¹å®šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹** ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
------------------------------------------------------------

.. code-block:: shell

    % pip-compile --upgrade-package requests
    % pip-sync --python-executable .venv/bin/python

https://github.com/ftnext/2024-slides/commit/62eb18134e95704acc9fb21cbd0e86f437153f88

ğŸŒ¯pip-toolsã®ææ¡ˆ
======================================================================

* transitiveãªä¾å­˜ã®ç®¡ç†ã®èª²é¡Œã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
* **é–‹ç™ºè€…ã¯directãªä¾å­˜ã ã‘ã‚’æŒ‡å®šã™ã‚‹**
* pip-toolsãŒé–‹ç™ºè€…ã«ä»£ã‚ã£ã¦transitiveãªä¾å­˜ã‚’ç®¡ç†ã—ã¦ãã‚Œã‚‹

pip-toolsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã¤ã„ã¦ï¼ˆã®æ„è¦‹ï¼‰
======================================================================

* `README <https://github.com/jazzband/pip-tools/tree/7.4.1?tab=readme-ov-file#installation>`__ ã§ã¯ã€ä»®æƒ³ç’°å¢ƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†æ¡ˆå†…ã•ã‚Œã‚‹
* ã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»®æƒ³ç’°å¢ƒã«ã‚‚å…¥ã‚Œã‚‹ï¼ŸğŸ¤”

**pipx** ã§å…¥ã‚Œã‚‹ã®ã‚’æ¨ã—ã¦å‚ã‚‹
--------------------------------------------------

.. code-block:: shell

    % pipx install pip-tools --python python3.11

ä»Šå›ã®ç’°å¢ƒ
--------------------------------------------------

* pipx 1.5.0
* Python 3.11.7
* pip-tools 7.4.1

pipxã£ã¦ã€ä½•ã‚ˆï¼Ÿ
--------------------------------------------------

* https://github.com/pypa/pipx
* PyPIã‚’App StoreåŒ–è¨ˆç”»
* ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã ã‘ã§å‹•ã‹ã™ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã€**pipxãŒç®¡ç†ã™ã‚‹å€‹åˆ¥ã®ä»®æƒ³ç’°å¢ƒ** ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œã‚‹

ã„ã¤ã‚‚ä»®æƒ³ç’°å¢ƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ :command:`pipx install` ã§ã„ã„ã®ã§ã¯
----------------------------------------------------------------------------------------------------

`Installing stand alone command line tools <https://packaging.python.org/en/latest/guides/installing-stand-alone-command-line-tools/>`__

* pip-toolsã ã‘ã§ãªã
* mypyã‚„Ruffãªã©ãªã©

pipxã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
--------------------------------------------------

* macOSã¯ :command:`brew install pipx` ğŸ™‹â€â™‚ï¸
* Ubuntu 23.04ä»¥é™ã§ :command:`apt install pipx`
* :command:`python3 -m pip install --user pipx`
* :command:`pipx ensurepath` ã‚’ãŠå¿˜ã‚Œãªã

https://github.com/pypa/pipx/tree/1.5.0?tab=readme-ov-file#install-pipx
