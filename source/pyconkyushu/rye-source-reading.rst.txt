Ryeã®ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã®å®Ÿè£…ç´¹ä»‹
======================================================================

Rustã¯é›°å›²æ°—ã§èª­ã‚“ã§ã„ã¾ã™ï¼ˆç§ã®æŠ€é‡ä¸è¶³ã§Pythonã»ã©æ·±æ˜ã‚Œã¾ã›ã‚“ï¼‰

Rye
======================================================================

* Pythonã‚‚ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ **ä¸¡æ–¹** ç®¡ç†ã™ã‚‹
* *Rust* ã®ã‚ˆã†ãªé–‹ç™ºä½“é¨“ï¼ˆ`Hatch <https://hatch.pypa.io/latest/environment/#dependencies>`__ ãŒè¿‘ã„ã‹ã‚‚ï¼‰
* https://rye.astral.sh/ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

Ryeã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒã®ä¾‹
--------------------------------------------------

* ``git clone https://github.com/ftnext/unko-by-rye.git``
* :command:`rye sync`

ãŸ ã£ ãŸ ã“ ã‚Œ ã  ã‘

Ryeã§ç®¡ç†ã™ã‚‹Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆ
--------------------------------------------------

.. code-block:: txt

    .
    â”œâ”€â”€ .python-version
    â”œâ”€â”€ .venv/
    â”œâ”€â”€ pyproject.toml
    â”œâ”€â”€ requirements.lock
    â””â”€â”€ requirements-dev.lock

Pythonã®ç®¡ç†
--------------------------------------------------

.. code-block:: txt
    :emphasize-lines: 2

    .
    â”œâ”€â”€ .python-version  # Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è¨˜è¼‰
    â”œâ”€â”€ .venv/
    â”œâ”€â”€ pyproject.toml
    â”œâ”€â”€ requirements.lock
    â””â”€â”€ requirements-dev.lock

ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç†
--------------------------------------------------

.. code-block:: txt
    :emphasize-lines: 3-6

    .
    â”œâ”€â”€ .python-version
    â”œâ”€â”€ .venv/  # lockãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒæœŸã—ãŸä»®æƒ³ç’°å¢ƒ
    â”œâ”€â”€ pyproject.toml
    â”œâ”€â”€ requirements.lock  # pyproject.tomlã®dependenciesè€ƒæ…®
    â””â”€â”€ requirements-dev.lock

ï¼ˆã‹ã¤ã¦ã®ï¼‰Ryeã®å®Ÿè£…
======================================================================

* ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ï¼švirtualenv + pip-tools
* æœ€æ–°ã® 0.34.0 ã§ã¯pip-toolsã«ä»£ãˆã¦ `uv <https://gihyo.jp/article/2024/03/monthly-python-2403>`__ ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«

Ryeã€Œé–‹ç™ºè€…ã¯ä»®æƒ³ç’°å¢ƒã‚’è§¦ã‚‰ãªã„ã§ :command:`rye sync` ã ã‘ã—ã¦ã€
======================================================================

* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»®æƒ³ç’°å¢ƒ :file:`.venv` ã« ``pip`` ãŒãªã„

.. code-block:: shell

    % .venv/bin/python -m pip list
    /.../.venv/bin/python: No module named pip

pipã®ãªã„ä»®æƒ³ç’°å¢ƒã®ä½œã‚Šæ–¹
--------------------------------------------------

.. code-block:: shell

    % python -m venv .venv/no_pip --without-pip
    % virtualenv .venv/virt_no_pip --no-seed  # Ryeã¯ã“ã¡ã‚‰

æ‹™ãƒ–ãƒ­ã‚° `Q: Pythonã§ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ„ãƒ¼ãƒ«pipã‚’å«ã¾ãªã„ä»®æƒ³ç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚â—¯ã‹â˜“ã‹ <https://nikkie-ftnext.hatenablog.com/entry/create-python-virtual-environments-without-pip>`__

pipã®ãªã„ä»®æƒ³ç’°å¢ƒã« ``pip-sync`` ã™ã‚‹ **ã¡ã‚‡ã†ãœã¤**
======================================================================

* ``PYTHONPATH`` ç’°å¢ƒå¤‰æ•°
* ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯

``PYTHONPATH`` ç’°å¢ƒå¤‰æ•°
--------------------------------------------------

.. code-block:: shell

    % .venv/no_pip/bin/python -m pip list
    /.../.venv/no_pip/bin/python: No module named pip
    % python -m venv .venv/with_pip --upgrade-deps
    % PYTHONPATH=$PWD/.venv/with_pip/lib/python3.11/site-packages .venv/no_pip/bin/python -m pip list
    Package    Version
    ---------- -------
    pip        24.0
    setuptools 70.0.0

æ‹™ãƒ–ãƒ­ã‚° `Q: Pythonã§ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ„ãƒ¼ãƒ«pipã‚’å«ã¾ãªã„ä»®æƒ³ç’°å¢ƒã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã€‚â—¯ã‹â˜“ã‹ <https://nikkie-ftnext.hatenablog.com/entry/python-no-pip-virtual-environments-pip-install-with-pythonpath>`__

ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
--------------------------------------------------

.. code-block:: shell

    % TMPDIR=$(mktemp -d)
    % ln -s $PWD/.venv/with_pip/lib/python3.11/site-packages/pip $TMPDIR/pip
    % PYTHONPATH=$TMPDIR .venv/no_pip/bin/python -m pip list
    % PYTHONPATH=$TMPDIR pip-sync --python-executable .venv/no_pip/bin/python
    % # pip-sync --python-executable .venv/no_pip/bin/python ã§ã¯ã€ŒModuleNotFoundError: No module named 'pip'ã€

æ‹™ãƒ–ãƒ­ã‚° `pipã®ãªã„ä»®æƒ³ç’°å¢ƒã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€RyeãŒpip-syncã§ãã‚‹"é­”æ³•"ã‚’ç†è§£ã™ã‚‹ <https://nikkie-ftnext.hatenablog.com/entry/rye-magic-pip-sync-at-no-pip-virtual-environment>`__

ğŸ¥ŸRyeã®ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã®å®Ÿè£…ç´¹ä»‹
======================================================================

* ä»®æƒ³ç’°å¢ƒ + pip-tools + **é–‹ç™ºè€…ã«è§¦ã‚‰ã›ãªã„** å·¥å¤«
* pipãŒãªã„ä»®æƒ³ç’°å¢ƒã§ã‚‚ ``PYTHONPATH`` ã‚’ä½¿ãˆã°ã€pipãŒã‚ã‚‹ç’°å¢ƒã®ã‚ˆã†ã«æ“ä½œã§ãã‚‹ï¼
