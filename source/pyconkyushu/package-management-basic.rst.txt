.. _distribution package: https://packaging.python.org/en/latest/glossary/#term-Distribution-Package
.. _import package: https://packaging.python.org/en/latest/glossary/#term-Import-Package

Pythonã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã®åŸºæœ¬ã‚’ãŠã•ãˆã‚‹
======================================================================

ä¸Šç´šã®è©±ã«å…¥ã‚‹ **å‰æº–å‚™**

* ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã¯
* ä»®æƒ³ç’°å¢ƒã¨ã¯

ãã‚‚ãã‚‚ *ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸* ã«ã¯ **2ç¨®é¡** ã‚ã‚‹
--------------------------------------------------

`Distribution package vs. import package (Python Packaging User Guide) <https://packaging.python.org/en/latest/discussions/distribution-package-vs-import-package/>`__

`distribution package`_ ï¼ˆ*é…å¸ƒ* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
------------------------------------------------------------

* :command:`pip install` ã§æŒ‡å®šã™ã‚‹
* :file:`pyproject.toml` ã® ``dependencies`` ã«æ›¸ã
* **æœ¬ãƒˆãƒ¼ã‚¯ã®ä¸»é¡Œ**

.. https://packaging.python.org/en/latest/discussions/distribution-package-vs-import-package/#what-s-a-distribution-package

`import package`_
--------------------------------------------------

* ``import`` æ–‡ã«æ›¸ã
* import packageã¯Python `ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« <https://docs.python.org/ja/3/glossary.html#term-module>`__

.. https://packaging.python.org/en/latest/discussions/distribution-package-vs-import-package/#what-s-an-import-package

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€ã¨ã¯
======================================================================

* distribution packageã®è©±ï¼ˆ``pip install``ï¼‰
* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å®Ÿä½“ã®ã‚³ãƒ¼ãƒ‰ï¼ˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®ã‚³ãƒ”ãƒ¼ã‚’ **ã‚ãªãŸã®ãƒã‚·ãƒ³ã«ç½®ã**

.. A versioned archive file ... ref: https://packaging.python.org/en/latest/glossary/#term-Distribution-Package

å®Ÿä½“ã®ã‚³ãƒ¼ãƒ‰ã¯ã©ã“ã‹ã‚‰å…¥æ‰‹ã™ã‚‹ã®ï¼Ÿ
--------------------------------------------------

* `ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ <https://packaging.python.org/en/latest/glossary/#term-Package-Index>`__
* distribution packageãŸã¡ã®ç´¢å¼•ã®Webã‚·ã‚¹ãƒ†ãƒ 

ä¸€ä¾‹ãŒPyPIï¼ˆã±ã„ã´ãƒ¼ã‚ã„ï¼‰
--------------------------------------------------

* Python Package Index
* https://pypi.org/simple/
* ``pip install`` ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¦‹ã¦ã„ã‚‹

.. https://pip.pypa.io/en/stable/cli/pip_install/#cmdoption-i
    default https://pypi.org/simple

PyPIä»¥å¤–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä¾‹ ğŸƒâ€â™‚ï¸
--------------------------------------------------

* `pip install <https://pip.pypa.io/en/stable/cli/pip_install/#options>`__ ã® :command:`--index-url` ã‚„ :command:`--extra-index-url`
* æŒ‡å®šã™ã‚‹ä¾‹ï¼š `CPUç’°å¢ƒã§å‹•ã‹ã™PyTorch <https://pytorch.org/get-started/locally/>`__

.. code-block:: shell

    % python -m pip install torch --index-url https://download.pytorch.org/whl/cpu

.. * åˆ¥ã®è©±é¡Œã¨ã—ã¦GitHubã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚å¯èƒ½

.. .. code-block:: shell

..    % python -m pip install git+https://github.com/ftnext/unko

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ãƒã‚·ãƒ³ã®ã©ã“ã«ã‚ã‚‹ã®ï¼Ÿ
--------------------------------------------------

* **site-packages** ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

.. code-block:: shell

    % python3.12 -m pip show httpx

    Location: /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages

ã‚°ãƒ­ãƒ¼ãƒãƒ«ã® :file:`site-packages` ã«å…¥ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ã®ã§çœŸä¼¼ã—ãªã„ã§ãã ã•ã„ğŸ™…â€â™‚ï¸

.. https://pip.pypa.io/en/stable/cli/pip_show/

:command:`pip install` ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ãªãœ ``import`` ã§ãã‚‹ï¼Ÿ ğŸƒâ€â™‚ï¸
----------------------------------------------------------------------

.. raw:: html

    <iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" frameborder="0" src="https://speakerdeck.com/player/4eeda4cc2011471d91e325c7df7dbaff?slide=38" title="ModuleNotFoundErrorã®å‚¾å‘ã¨å¯¾ç­–:ä»•çµ„ã¿ã‹ã‚‰å­¦ã¶Import / Unpacking ModuleNotFoundError" allowfullscreen="true" data-ratio="1.7777777777777777"></iframe>

:file:`site-packages` ãŒ ``sys.path`` ã«å…¥ã£ã¦ã„ã‚‹ã‹ã‚‰ ğŸƒâ€â™‚ï¸
------------------------------------------------------------

.. code-block:: shell

    % python3.12 -m site
    sys.path = [
    <ç•¥>
    '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages',
    ]

.. https://docs.python.org/ja/3/library/site.html#command-line-interface

ğŸ¥Ÿãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€ã¨ã¯
--------------------------------------------------

* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆä¸»ã«PyPIï¼‰ã‹ã‚‰
* distribution packageã® **å®Ÿä½“ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«** ã‚’ã‚³ãƒ”ãƒ¼ã—
* ãƒã‚·ãƒ³ã® **site-packagesã«é…ç½®** ã™ã‚‹ï¼ˆè§£å‡ãªã©ã®è©³ç´°ã¯ä»Šå›ã¯çœç•¥ï¼‰

ä»®æƒ³ç’°å¢ƒã¨ã¯
======================================================================

* **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**
* Node.jsã§ã„ã† :file:`node_modules`

ä»®æƒ³ç’°å¢ƒã¯ **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**
--------------------------------------------------

    ä»®æƒ³ç’°å¢ƒã¨ã¯ã€ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® Python ã¨å¹¾ã¤ã‹ã®è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å«ã‚“ã  Python ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ§‹æˆã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã™ã€‚

`12.1. ã¯ã˜ã‚ã«ï¼ˆPython ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« 12. ä»®æƒ³ç’°å¢ƒã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ <https://docs.python.org/ja/3/tutorial/venv.html#introduction>`__

ä»®æƒ³ç’°å¢ƒã‚’ä½œã‚‹ãƒ„ãƒ¼ãƒ«
--------------------------------------------------

* æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® `venv <https://docs.python.org/ja/3/library/venv.html>`__
* ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã® `virtualenv <https://virtualenv.pypa.io/en/latest/index.html>`__
* virtualenvãŒå…ˆã«ã‚ã‚Šã€äººæ°—ã‚’å—ã‘ã¦æ¨™æº–ã«å…¥ã£ãŸï¼ˆ`PEP 405 <https://peps.python.org/pep-0405/>`__ï¼‰

ä»®æƒ³ç’°å¢ƒã¯ã“ã‚“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
--------------------------------------------------

.. literalinclude:: virtualenv-tree.txt
    :language: txt

ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼
--------------------------------------------------

.. literalinclude:: virtualenv-tree.txt
    :language: txt
    :emphasize-lines: 7-9

:file:`.venv/lib/python3.12/` ãŒã§ãã‚‹ã®ãŒå¬‰ã—ã„ï¼ˆå¾Œè¿°ï¼‰
------------------------------------------------------------

.. literalinclude:: virtualenv-tree.txt
    :language: txt
    :emphasize-lines: 10-11

ãªãœä»®æƒ³ç’°å¢ƒãŒå¿…è¦ãªã®ã‹
======================================================================

* ä»®æƒ³ç’°å¢ƒã‚’ä½¿ã‚ãªã„ã¨ã™ã‚‹ã¨ :file:`site-packages` ãŒ **ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®1ã¤** ã®ã¿
* åŒåãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³é•ã„ãŒå…±å­˜ã§ããªã„ğŸ™€

ğŸ“ŒPythonã§ã¯é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ†ã‘ã‚ˆã†
------------------------------------------------------------

* **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ä»®æƒ³ç’°å¢ƒ** ã‚’ç”¨æ„ã™ã‚‹
* ï¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã® :file:`site-packages`

ãã®ä»–ã®æ–¹æ³•ï¼ˆæœ¬ãƒˆãƒ¼ã‚¯ã®ã‚¹ã‚³ãƒ¼ãƒ—å¤–ï¼‰ğŸƒâ€â™‚ï¸
--------------------------------------------------

* Anaconda

  * `2023å¹´6æœˆ stapy#94 <https://startpython.connpass.com/event/272159/>`__ ã§å–ã‚Šä¸Šã’

* Docker

  * `Dev Containersæ™‚ä»£ã®Pythoné–‹ç™ºç’°å¢ƒã®ã‚ã‚Šæ–¹ <https://2023-apac.pycon.jp/timetable?id=M8QP3X>`__ ï¼ˆPyCon APAC 2023ï¼‰

ä»®æƒ³ç’°å¢ƒã®ä»•çµ„ã¿
--------------------------------------------------

* ç’°å¢ƒå¤‰æ•° ``PATH`` ã‚’æ›´æ–°

.. code-block:: shell

    $ source .venv/bin/activate
    (.venv) $ python -V
    Python 3.12.3
    (.venv) $ .venv/bin/python -V  # PATHãŒæ›´æ–°ã•ã‚Œã¦ã„ã¦ã€ã“ã‚ŒãŒè¦‹ã¤ã‹ã£ã¦ã„ã‚‹
    Python 3.12.3
    (.venv) $ type python
    python is /.../.venv/bin/python

.. revealjs-break::

* :command:`pip install` ã§ä»®æƒ³ç’°å¢ƒã® :file:`site-packages` ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹

.. code-block:: shell

    (.venv) % python -m pip show httpx

    Location: /.../.venv/lib/python3.12/site-packages

.. revealjs-break::

* ``import`` ã§ã‚‚ä»®æƒ³ç’°å¢ƒã® :file:`site-packages` ãŒå‚ç…§ã•ã‚Œã‚‹

.. code-block:: shell

    (.venv) % python -m site
    sys.path = [
    <ç•¥>
    '/.../.venv/lib/python3.12/site-packages',
    ]

ä»®æƒ³ç’°å¢ƒã®è€ƒãˆæ–¹
======================================================================

* ä½¿ã„æ¨ã¦ï¼ˆdisposableï¼‰
* ç§»å‹•ã‚„ã‚³ãƒ”ãƒ¼ã¯ã—ãªã„ï¼ˆåŒã˜ä»®æƒ³ç’°å¢ƒã‚’éƒ½åº¦ä½œã‚‹ï¼‰

`venv --- Creation of virtual environments <https://docs.python.org/ja/3/library/venv.html>`__ ï¼ˆPython 3.12ã§æ›´æ–°ã•ã‚ŒãŸæ„Ÿï¼‰

ç’°å¢ƒã‚’å†ç¾ã™ã‚‹ã«ã¯
--------------------------------------------------

:command:`pip freeze` ã¨ ``pip install``

.. revealjs-break::

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« `12.3. pip ã‚’ä½¿ã£ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† <https://docs.python.org/ja/3/tutorial/venv.html#managing-packages-with-pip>`__

    ``python -m pip freeze`` ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§ã‚’ã€``python -m pip install`` ãŒè§£é‡ˆã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ç”Ÿæˆã—ã¾ã™ã€‚

ç’°å¢ƒã‚’å†ç¾ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
--------------------------------------------------

.. code-block:: shell

    $ python -m pip freeze > requirements.txt
    $ python -m pip install -r requirements.txt

* freezeï¼šå‹•ä½œã™ã‚‹ç’°å¢ƒã«å…¥ã£ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ—æŒ™
* installï¼šæŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ **2ç¨®é¡** ã‚ã‚‹
======================================================================

:direct: ç§ãŸã¡ãŒ :command:`pip install` ã§æŒ‡å®š
:transitive: directãªä¾å­˜ãŒä¾å­˜ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

ç”¨èªã¯ `The maze of Python dependency management <https://blog.frankel.ch/maze-python-dependency-management/>`__ ã‹ã‚‰

httpxã‚’ä¾‹ã«ã€2ç¨®é¡ã®ä¾å­˜
--------------------------------------------------

.. code-block:: shell

    $ python -m pip install httpx  # directã®ä¾å­˜

    Installing collected packages: sniffio, idna, h11, certifi, httpcore, anyio, httpx
    Successfully installed anyio-4.3.0 certifi-2024.2.2 h11-0.14.0 httpcore-1.0.5 httpx-0.27.0 idna-3.7 sniffio-1.3.1

:command:`pip freeze` ã®å°ã•ãªèª²é¡Œ
--------------------------------------------------

* directãªä¾å­˜ã‚‚transitiveãªä¾å­˜ã‚‚1ã¤ã® :file:`requirements.txt` ã«ã¾ã¨ã¾ã‚‹
* **transitiveãªä¾å­˜ã®å‰Šé™¤** ãŒå¤§å¤‰

:file:`requirements.txt` ã‹ã‚‰ã®å‰Šé™¤ãŒå¤§å¤‰
--------------------------------------------------

.. code-block:: shell

    % # å‰æã¨ã—ã¦ã€Python 3.11ã§ä½œã£ãŸä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–ã—ã¦ã„ã¾ã™
    % python -m pip install transformers
    $ python -m pip freeze > requirements.txt
    % python -m pip install rouge-score
    $ python -m pip freeze > requirements.txt

rouge-scoreãŒä¸è¦ã«ãªã£ãŸ
--------------------------------------------------

* :command:`pip uninstall rouge-score` ã§ã¯rouge-scoreã®ä¾å­˜ã¯å‰Šé™¤ã•ã‚Œãªã„
* rouge-scoreã®ä¾å­˜ã‚‚1ã¤1ã¤ ``pip uninstall`` ãŒå¿…è¦

å…¨éƒ¨uninstallã—ã¦ã„ã„ã‚ã‘ã§ã¯ãªã„
--------------------------------------------------

* rouge-scoreã®ä¾å­˜ã«ã¯ã€**transformersãŒä¾å­˜** ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚å­˜åœ¨ã™ã‚‹
* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§transitiveãªä¾å­˜ã®ã†ã¡ã€**rouge-scoreã—ã‹ä¾å­˜ã—ã¦ã„ãªã„ã‚‚ã®ã‚’æ´—ã„å‡ºã—ã¦** æ¶ˆã—ãŸã„
* :file:`requirements.txt` ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã—ã¦ã„ãŸã‚‰ãŸã‚„ã™ã„ã®ã‹ã‚‚ï¼ˆãˆã¦ã—ã¦å¿˜ã‚ŒãŒã¡ï¼‰

ğŸ¥Ÿä»®æƒ³ç’°å¢ƒã¨ã¯
--------------------------------------------------

* ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€‚**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ã® site-packages** ã‚’è¨­ã‘ã‚‹
* ``pip freeze`` ã—ã¦ **éƒ½åº¦ä½œã‚‹** æ–¹æ³•ãŒãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯æ¡ˆå†…ã•ã‚Œã‚‹
* **transitiveãªä¾å­˜** ã®ç®¡ç†ãŒç§ã«ã¯ãƒ„ãƒ©ã‚¤
